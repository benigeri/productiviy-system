{"id":"ps-1","title":"Phase 6 verification test","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-10T22:46:40.175573-05:00","created_by":"benigeri","updated_at":"2026-01-10T22:46:53.749966-05:00","closed_at":"2026-01-10T22:46:53.749966-05:00","close_reason":"Phase 6 verification test - deleting"}
{"id":"ps-10","title":"Backend: Implement POST /api/compose/save endpoint","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 1.3\n\n**Objective**: Save composed draft to Gmail via Nylas API (no reply context).\n\n**File**: /Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/save/route.ts\n\n**Key Requirements**:\n- Zod schema: subject, draftBody, to[] (min 1), cc[] (default [])\n- Validate recipients with .email() Zod validator\n- Get user email from Nylas grant (filter from CC)\n- Create Nylas draft WITHOUT reply_to_message_id\n- Plain subject (NOT 'Re: ...')\n- Return draftId on success\n\n**Reuse Pattern**: Copy 70% from /api/drafts/save/route.ts, remove:\n- reply_to_message_id field\n- Label update logic\n- 'Re:' prefix on subject\n\n**Time Estimate**: 45 minutes\n\n**Test File**: app/api/compose/save/route.test.ts (create with this task)\n\n**Context**: Read full plan for Nylas API details and differences from reply endpoint.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:27:46.780265-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:27:46.780265-05:00","dependencies":[{"issue_id":"ps-10","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.730196-05:00","created_by":"import"}]}
{"id":"ps-11","title":"Frontend: Create ComposeFAB component","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 2.1\n\n**Objective**: Gmail-style floating action button that opens compose modal.\n\n**File**: /Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeFAB.tsx\n\n**Key Requirements**:\n- Fixed position: bottom-8 right-8 z-40\n- Circular button (size-14 = 56px)\n- Pencil icon from lucide-react\n- Blue background (bg-blue-600)\n- Opens ComposeModal on click\n- State: isOpen (boolean)\n\n**Integration**:\n- Add to ThreadList.tsx ONLY (not ThreadDetail per simplicity review)\n- Import at top, render at end of component\n\n**Time Estimate**: 15 minutes\n\n**Full code provided in plan** - copy/paste and adjust as needed.\n\n**Context**: This is the user's entry point to the feature. Keep it simple and obvious.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:27:55.863587-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:27:55.863587-05:00","dependencies":[{"issue_id":"ps-11","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.73124-05:00","created_by":"import"}]}
{"id":"ps-12","title":"Frontend: Create ComposeModal wrapper","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 2.2\n\n**Objective**: Modal overlay that contains the compose form.\n\n**File**: /Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeModal.tsx\n\n**Key Requirements**:\n- Dark overlay: fixed inset-0 z-50 bg-black/50\n- Modal container: fixed inset-4 md:inset-20\n- Close button (X icon, top-right)\n- Escape key handler (useEffect)\n- Click outside to close (onClick on overlay)\n- Stop propagation on modal content\n\n**Props**:\n- isOpen: boolean\n- onClose: () =\u003e void\n\n**Time Estimate**: 20 minutes\n\n**Full code provided in plan** - copy/paste and adjust styling as needed.\n\n**Context**: Simple wrapper for accessibility and UX. Don't overthink it.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:28:03.240603-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:28:03.240603-05:00","dependencies":[{"issue_id":"ps-12","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.731826-05:00","created_by":"import"}]}
{"id":"ps-13","title":"Frontend: Create ComposeForm component","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 2.3\n\n**Objective**: Core compose logic reusing ThreadDetail pattern with key differences.\n\n**File**: /Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeForm.tsx\n\n**Key Differences from ThreadDetail**:\n1. No thread/messages props\n2. Static ID: 'compose-draft' (not timestamp)\n3. NO useConversation hook - local state only\n4. Call /api/compose (not /api/drafts)\n5. Call /api/compose/save (not /api/drafts/save)\n6. No Skip button (only Cancel + Approve)\n7. Add recipient display with sanitization: encodeURIComponent(email)\n8. Add subject display (read-only)\n9. Track conversationHistory in local state\n\n**State** (simplified):\n- instructions, feedback, draft, subject, recipients, conversationHistory\n- loading, saving, error\n\n**Security**: Sanitize emails before display using encodeURIComponent()\n\n**UI Structure** (same as ThreadDetail):\n1. Instruction textarea (no draft state)\n2. Generate button\n3. Draft preview (blue bg)\n4. Recipients display (To/CC sanitized)\n5. Subject display\n6. Feedback textarea\n7. Regenerate button\n8. Cancel + Approve buttons\n\n**Time Estimate**: 2 hours\n\n**Reference**: /Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ThreadDetail.tsx\n\n**Context**: This is the heart of the feature. Read ThreadDetail.tsx first, then adapt with changes from plan.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:28:15.887344-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:28:15.887344-05:00","dependencies":[{"issue_id":"ps-13","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.732335-05:00","created_by":"import"}]}
{"id":"ps-14","title":"Testing: Write basic API and component tests","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 3.1\n\n**Objective**: Behavior-focused tests (not coverage metrics).\n\n**Test Files to Create**:\n1. app/api/compose/route.test.ts\n2. app/api/compose/save/route.test.ts\n3. app/inbox/ComposeForm.test.tsx\n\n**Test Coverage** (behavior-focused):\n- ✅ API returns validated response (Zod)\n- ✅ API handles malformed JSON from AI\n- ✅ Component renders instruction textarea\n- ✅ Component shows draft after generation\n- ✅ Component shows errors on failure\n- ✅ Save endpoint validates recipients\n\n**Pattern**: Follow existing test patterns from:\n- app/api/drafts/route.test.ts\n- app/inbox/ThreadDetail.test.tsx\n\n**Time Estimate**: 1 hour\n\n**Context**: Test behavior, not implementation. Focus on happy path + critical errors. Don't aim for arbitrary coverage %.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:28:24.030061-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:28:24.030061-05:00","dependencies":[{"issue_id":"ps-14","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.732815-05:00","created_by":"import"}]}
{"id":"ps-15","title":"Testing: Manual E2E verification","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 3.2\n\n**Objective**: Verify feature works end-to-end before closing epic.\n\n**Dev Server**: npm run dev\n\n**Test Scenarios** (checklist):\n1. ✅ Click FAB → modal opens\n2. ✅ Enter: 'Email john@example.com about Q1 results'\n3. ✅ Draft generates with subject, body, recipients\n4. ✅ Provide feedback: 'Make it shorter'\n5. ✅ Draft regenerates\n6. ✅ Click Approve → saves to Gmail\n7. ✅ Modal closes\n8. ✅ Open Gmail → verify draft exists\n\n**Edge Cases**:\n- Invalid instruction (AI handles gracefully)\n- No recipients (AI explains in body)\n- Network failure (error shows)\n- Close modal mid-generation (cancelled)\n\n**Error Testing**:\n- Disconnect network → try generate → verify error\n- Reconnect → retry → success\n\n**Automated Checks**: Run npm run test, npm run lint, npm run build\n\n**Time Estimate**: 30 minutes\n\n**Context**: This is the final verification. All previous tasks must be complete. Reference Definition of Done in plan.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:28:34.270818-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:28:34.270818-05:00","dependencies":[{"issue_id":"ps-15","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.733291-05:00","created_by":"import"}]}
{"id":"ps-2","title":"Clean up open pull requests in repository","description":"## Problem\nRepository has accumulated multiple open pull requests that need review and cleanup. Need to go through each PR, determine status, and either merge, close, or update.\n\n## Scope\n- Review all open PRs\n- Identify which are ready to merge\n- Identify which should be closed (stale/obsolete)\n- Identify which need updates or rebase\n- Clean up and organize\n\n## Questions to Address\n- Which PRs are still relevant?\n- Which PRs conflict with current main?\n- Which PRs need testing/verification before merge?\n- Are there any dependencies between PRs?","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T23:18:39.086175-05:00","created_by":"benigeri","updated_at":"2026-01-10T23:18:39.086175-05:00"}
{"id":"ps-3","title":"[epic] Production Polish for Launch","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-11T00:25:26.399243-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:31:49.342249-05:00","dependencies":[{"issue_id":"ps-3","depends_on_id":"ps-4","type":"blocks","created_at":"2026-01-11T00:41:26.733759-05:00","created_by":"import"},{"issue_id":"ps-3","depends_on_id":"ps-5","type":"blocks","created_at":"2026-01-11T00:41:26.734194-05:00","created_by":"import"},{"issue_id":"ps-3","depends_on_id":"ps-6","type":"blocks","created_at":"2026-01-11T00:41:26.734633-05:00","created_by":"import"}]}
{"id":"ps-4","title":"Fix email rendering: use cleaned_body, preserve line breaks, handle quoted replies","description":"**Problem**: Email rendering is messy with bad spacing, 'span span' appearing where images should be, quoted replies showing raw markup.\n\n**Root Cause**: \n- Using Nylas /messages/clean with ignore_images:true replaces \u003cimg\u003e with literal 'span' text\n- Not properly rendering line breaks from markdown\n- Quoted replies (\u003e \u003e \u003e) showing raw instead of being styled/collapsed\n\n**Solution**:\n1. Switch to cleaned_body field from Nylas (not raw body)\n2. Preserve line breaks in UI rendering\n3. Style quoted replies (gray/indented) or collapse them\n4. Add principle to CLAUDE.md: Always use Nylas clean API for email bodies\n\n**Files**:\n- app/inbox/page.tsx (already using /messages/clean endpoint)\n- app/inbox/ThreadDetail.tsx (rendering logic)\n- CLAUDE.md (add principle)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T00:25:36.144891-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:38:10.339997-05:00","closed_at":"2026-01-11T00:38:10.339997-05:00","close_reason":"Fixed email rendering (ignore_images: false, line break preservation, styled quoted replies) and added sticky navigation controls (top nav with Prev/Next, sticky bottom controls, scrollable middle section)"}
{"id":"ps-5","title":"Fix Braintrust prompt: user instructions and emails not being passed","description":"**Problem**: Generated drafts don't follow user instructions and don't reference the email thread properly. User confirmed: 'We're not passing in my prompt. It got deleted somehow. And we're also not passing in my emails.'\n\n**Root Cause**:\n- Braintrust prompt template (slug: email-draft-generation) is either deleted or not using {{user_instructions}} and {{messages}} variables correctly\n- Code IS sending the data (drafts/route.ts lines 59-72) but template not consuming it\n\n**What Code Sends**:\n```javascript\ninvoke({\n  projectName: 'Email_Workflow',\n  slug: 'email-draft-generation',\n  input: {\n    thread_subject: subject,\n    messages: [{from, to, date, body}, ...],\n    user_instructions: 'User typed instructions'\n  }\n})\n```\n\n**Solution**:\n1. Check Braintrust UI for prompt template at slug 'email-draft-generation'\n2. Verify template uses {{user_instructions}} and {{#each messages}}\n3. If deleted, recreate from README.md template (lines 34-54)\n4. Add logging to drafts/route.ts to debug what's sent/received\n5. Test with real thread to confirm instructions are followed\n\n**Expected Template**:\n```\nYou are an email assistant helping to draft professional replies.\n\nThread Subject: {{thread_subject}}\n\nPrevious Messages:\n{{#each messages}}\nFrom: {{this.from}}\nTo: {{this.to}}\nDate: {{this.date}}\n\n{{this.body}}\n\n---\n{{/each}}\n\nUser Instructions: {{user_instructions}}\n\nGenerate a professional email reply based on the user's instructions...\n```\n\n**Files**:\n- Braintrust UI (https://braintrust.dev) - check/fix prompt template\n- app/api/drafts/route.ts (add logging)\n- README.md (reference for template)","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-11T00:25:48.60499-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:25:48.60499-05:00"}
{"id":"ps-6","title":"Redesign bottom UI: sticky nav + floating draft controls (Option A)","description":"**Problem**: Draft controls (Regenerate, Skip, Approve buttons) are at the bottom of a long scrollable page and disappear when scrolling. Poor UX - can't see controls when reviewing long email threads.\n\n**Solution**: Option A - Minimal Floating Controls\n\n**Layout**:\n```\n┌─────────────────────────────────┐\n│  ← Back to Inbox    [Next →]    │  ← Sticky top nav\n└─────────────────────────────────┘\n\n[Scrollable email thread + draft preview]\n\n┌─────────────────────────────────┐\n│ ┌─────────────────────────────┐ │\n│ │ Your reply instructions... │ │  ← Sticky bottom\n│ └─────────────────────────────┘ │\n│ [Generate Draft]                │\n│ [Skip]  [Approve \u0026 Send]        │\n└─────────────────────────────────┘\n```\n\n**Changes**:\n1. **Sticky top nav**: \n   - '← Back to Inbox' fixed at top\n   - Add [← Prev] [Next →] navigation buttons\n   - Stays visible when scrolling\n\n2. **Sticky bottom controls** (always visible):\n   - Textarea for instructions/feedback\n   - Generate Draft / Regenerate Draft button\n   - Skip / Approve \u0026 Send to Gmail buttons\n\n3. **Scrollable middle section**:\n   - Email thread messages\n   - Draft preview (when generated)\n   - Draft iteration history\n\n**Design** (Option A):\n```\n┌─────────────────────────────────┐\n│  ← Back to Inbox    [Next →]    │  ← Sticky top nav\n└─────────────────────────────────┘\n\n[Scrollable email thread + draft preview]\n\n┌─────────────────────────────────┐\n│ ┌─────────────────────────────┐ │\n│ │ Your reply instructions... │ │  ← Sticky bottom\n│ └─────────────────────────────┘ │\n│ [Generate Draft]                │\n│ [Skip]  [Approve \u0026 Send]        │\n└─────────────────────────────────┘\n```\n\n**Changes Needed**:\n1. Make top nav sticky: '← Back to Inbox' + '[← Prev] [Next →]'\n2. Make bottom controls sticky/floating:\n   - Instructions textarea\n   - Generate/Regenerate Draft button\n   - Skip and Approve \u0026 Send buttons\n3. Email thread + draft preview scrollable in middle\n4. Keep Draft Iteration History section (don't delete)\n\n**Design Details (Option A)**:\n- Sticky top nav: Back to Inbox (left) + Prev/Next buttons (right)\n- Scrollable middle: Email thread + draft preview + iteration history\n- Sticky bottom: Textarea for instructions + action buttons\n- All sticky elements use fixed positioning with proper z-index\n\n**Files**:\n- app/inbox/ThreadDetail.tsx (add sticky positioning, restructure layout)\n- Possibly extract to separate components for cleaner code","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T00:26:05.576867-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:38:10.3405-05:00","closed_at":"2026-01-11T00:38:10.3405-05:00","close_reason":"Fixed email rendering (ignore_images: false, line break preservation, styled quoted replies) and added sticky navigation controls (top nav with Prev/Next, sticky bottom controls, scrollable middle section)"}
{"id":"ps-7","title":"[epic] Compose Email Feature (AI-powered)","description":"# Compose Email Feature - Simplified Implementation Plan\n\n## Overview\nAdd a compose email feature that allows users to create new emails from scratch using AI generation. Users click a Gmail-style floating action button (FAB), provide a brief instruction including recipients, and the AI generates a complete email with subject line and body. Users can iterate with feedback before saving to Gmail.\n\n**This plan incorporates feedback from three specialized reviewers (DHH, Kieran, Simplicity) to eliminate unnecessary complexity while maintaining essential security and quality standards.**\n\n## Requirements Summary\n- **Use Case**: Compose new emails from scratch (not replies)\n- **AI Generation**: Full AI generation from brief instruction\n- **Recipients**: User includes recipients in brief (e.g., \"Email john@example.com about Q1\"), AI extracts To/CC\n- **MVP Features**: Support To and CC only (BCC cut from MVP)\n- **UI Entry Point**: Floating Action Button (FAB) - overlays inbox, opens modal\n- **Draft Flow**: Same iteration flow as existing reply system (generate → feedback → iterate → approve)\n- **Storage**: Component state only (no localStorage), save final draft to Gmail\n- **Error Handling**: Show clear errors, let user iterate with feedback\n- **Multi-Draft**: One draft at a time with static ID \"compose-draft\"\n\n## Key Simplifications (Based on Reviews)\n\n### What We Cut:\n1. ❌ **Email parser utility** - AI returns structured JSON, trust it (169 LOC saved)\n2. ❌ **localStorage persistence** - Not needed for compose workflow (80 LOC saved)\n3. ❌ **BCC support** - Add when users request it (30 LOC saved)\n4. ❌ **Conversation history UI** - Just track in component state, no display needed (40 LOC saved)\n5. ❌ **80% coverage target** - Test behavior, not metrics\n6. ❌ **Timestamp IDs** - Use static \"compose-draft\" for single-session drafts\n\n### What We Keep:\n- ✅ Zod validation (essential for type safety and security)\n- ✅ Modal pattern (familiar UX)\n- ✅ AI recipient extraction (core value prop)\n- ✅ Iteration workflow (proven pattern from ThreadDetail)\n- ✅ Two API endpoints (clear separation of concerns)\n\n### Essential Security Fixes:\n1. **Zod validation of AI responses** - Prevents runtime crashes from malformed JSON\n2. **Sanitize email addresses before display** - Basic XSS protection using `encodeURIComponent()`\n\n**Total reduction: ~350 lines of unnecessary code eliminated**\n\n## Architecture Overview\n\n### New Components (3)\n1. **ComposeFAB.tsx** - Floating action button (entry point)\n2. **ComposeModal.tsx** - Modal overlay wrapper\n3. **ComposeForm.tsx** - Core compose logic (reuses ThreadDetail pattern)\n\n### New API Endpoints (2)\n1. **POST /api/compose** - Generate draft with recipient extraction\n2. **POST /api/compose/save** - Save to Gmail (without reply context)\n\n### Reused Infrastructure\n- ThreadDetail iteration UI pattern (textarea → generate → feedback → iterate → approve)\n- Braintrust LLM integration (new prompt slug: `email-compose-v1`)\n- Nylas API for Gmail drafts\n- Existing error handling patterns from `/api/drafts`\n\n### NOT Used (Simplified):\n- ~~useConversation hook~~ - Component state only\n- ~~localStorage~~ - No persistence needed\n- ~~Email parser utility~~ - Trust AI JSON output\n- ~~Client-side email validation~~ - Let Nylas validate\n\n## Implementation Tasks\n\n### Phase 1: Backend API (2 tasks)\n\n#### Task 1.1: Create Braintrust Compose Prompt\n**Location**: Braintrust dashboard (web UI)\n**Slug**: `email-compose-v1`\n\n**System Prompt**:\n```\nYou are an expert email composer. Given a user's brief instruction, generate a complete professional email.\n\nExtract recipients (to/cc) from the instruction. Return ONLY a JSON object:\n\n{\n  \"subject\": \"Clear, concise subject line (5-10 words)\",\n  \"body\": \"Professional email body with greeting and signature\",\n  \"to\": [\"john@example.com\", \"Jane Doe \u003cjane@example.com\u003e\"],\n  \"cc\": [\"optional@example.com\"]\n}\n\nGuidelines:\n- Extract ALL explicitly mentioned recipients\n- Use \"to\" for primary recipients, \"cc\" for secondary\n- If no recipients found, return empty arrays and explain in body\n- Body should be complete (greeting + content + sign-off)\n- Keep tone professional unless instructed otherwise\n\nIf previous_draft is provided, improve it based on user feedback while keeping recipients unless explicitly changed.\n```\n\n**Environment variable**: Add `BRAINTRUST_COMPOSE_SLUG=email-compose-v1` to `.env`\n\n**Time estimate**: 10 minutes\n\n#### Task 1.2: Implement POST /api/compose Endpoint\n**File**: `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/route.ts`\n\n**Request Schema** (Zod):\n```typescript\nconst ComposeRequestSchema = z.object({\n  instructions: z.string().min(1).max(5000),\n  conversationHistory: z.array(\n    z.object({\n      role: z.enum(['user', 'assistant']),\n      content: z.string(),\n    })\n  ).optional(),\n});\n```\n\n**Response Schema** (Zod - NEW, critical for security):\n```typescript\nconst ComposeResponseSchema = z.object({\n  subject: z.string().min(1).max(200),\n  body: z.string().min(1).max(50000),\n  to: z.array(z.string()).min(0).max(20),\n  cc: z.array(z.string()).default([]),\n});\n```\n\n**Implementation**:\n1. Validate request with ComposeRequestSchema\n2. Call Braintrust invoke() with `email-compose-v1` slug\n3. **Parse AI response and validate with ComposeResponseSchema** (security fix)\n4. Handle JSON parsing errors gracefully (return error if AI returns non-JSON)\n5. Return structured response\n\n**Error Handling**:\n- Invalid JSON from AI: Return 500 with \"AI returned invalid response\"\n- Missing recipients: Return valid response with empty to/cc arrays\n- Braintrust failure: Return 500 with retry message\n- Validation failure: Return 400 with Zod error details\n\n**Time estimate**: 1 hour\n\n#### Task 1.3: Implement POST /api/compose/save Endpoint\n**File**: `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/save/route.ts`\n\n**Request Schema**:\n```typescript\nconst SaveComposeSchema = z.object({\n  subject: z.string().min(1).max(200),\n  draftBody: z.string().min(1).max(50000),\n  to: z.array(z.string().email()).min(1).max(20),\n  cc: z.array(z.string().email()).default([]),\n});\n```\n\n**Implementation** (reuse 70% of `/api/drafts/save/route.ts`):\n1. Validate request with SaveComposeSchema\n2. Get user's email from Nylas grant (filter from CC)\n3. Create draft via Nylas `/drafts` endpoint:\n   - Plain subject (NOT \"Re: ...\")\n   - NO `reply_to_message_id` field\n   - to and cc only (no bcc)\n4. Return success with draftId (no label updates)\n\n**Key Differences from Reply Save**:\n- No `reply_to_message_id`\n- Plain subject (not \"Re: ...\")\n- No label updates (compose doesn't affect inbox)\n\n**Time estimate**: 45 minutes\n\n### Phase 2: Frontend Components (3 tasks)\n\n#### Task 2.1: Create ComposeFAB Component\n**File**: `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeFAB.tsx`\n\n**Structure**:\n```tsx\n'use client';\n\nimport { useState } from 'react';\nimport { Pencil } from 'lucide-react';\nimport { ComposeModal } from './ComposeModal';\n\nexport function ComposeFAB() {\n  const [isOpen, setIsOpen] = useState(false);\n\n  return (\n    \u003c\u003e\n      \u003cbutton\n        onClick={() =\u003e setIsOpen(true)}\n        className=\"fixed bottom-8 right-8 z-40 size-14 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition flex items-center justify-center\"\n        aria-label=\"Compose new email\"\n      \u003e\n        \u003cPencil className=\"size-6\" /\u003e\n      \u003c/button\u003e\n\n      \u003cComposeModal isOpen={isOpen} onClose={() =\u003e setIsOpen(false)} /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n**Integration**: Add to ThreadList.tsx only (not ThreadDetail per simplicity review)\n\n**Time estimate**: 15 minutes\n\n#### Task 2.2: Create ComposeModal Wrapper\n**File**: `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeModal.tsx`\n\n**Structure**:\n```tsx\n'use client';\n\nimport { useEffect } from 'react';\nimport { X } from 'lucide-react';\nimport { ComposeForm } from './ComposeForm';\n\nexport function ComposeModal({ isOpen, onClose }: { isOpen: boolean; onClose: () =\u003e void }) {\n  // Escape key handler\n  useEffect(() =\u003e {\n    if (!isOpen) return;\n\n    const handleEscape = (e: KeyboardEvent) =\u003e {\n      if (e.key === 'Escape') onClose();\n    };\n\n    document.addEventListener('keydown', handleEscape);\n    return () =\u003e document.removeEventListener('keydown', handleEscape);\n  }, [isOpen, onClose]);\n\n  if (!isOpen) return null;\n\n  return (\n    \u003cdiv\n      className=\"fixed inset-0 z-50 bg-black/50\"\n      onClick={onClose}\n    \u003e\n      \u003cdiv\n        className=\"fixed inset-4 md:inset-20 bg-white rounded-lg overflow-auto\"\n        onClick={(e) =\u003e e.stopPropagation()}\n      \u003e\n        \u003cbutton\n          onClick={onClose}\n          className=\"absolute top-4 right-4 text-gray-500 hover:text-gray-700\"\n        \u003e\n          \u003cX className=\"size-6\" /\u003e\n        \u003c/button\u003e\n\n        \u003cComposeForm onClose={onClose} /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n**Time estimate**: 20 minutes\n\n#### Task 2.3: Create ComposeForm Component\n**File**: `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeForm.tsx`\n\n**Key Differences from ThreadDetail**:\n1. No thread/messages props\n2. Static draft ID: \"compose-draft\" (not timestamp)\n3. **No useConversation hook** - Use local component state only\n4. Add recipient display section (simple text display with sanitization)\n5. Add subject line display (read-only for MVP)\n6. Call `/api/compose` instead of `/api/drafts`\n7. Call `/api/compose/save` instead of `/api/drafts/save`\n8. No \"Skip\" button (only \"Cancel\" and \"Approve\")\n9. onClose callback to close modal after save\n10. **Track conversation history in local state** (for regeneration context)\n\n**State Management** (simplified):\n```typescript\nconst [instructions, setInstructions] = useState('');\nconst [feedback, setFeedback] = useState('');\nconst [draft, setDraft] = useState('');\nconst [subject, setSubject] = useState('');\nconst [recipients, setRecipients] = useState\u003c{ to: string[]; cc: string[] }\u003e({ to: [], cc: [] });\nconst [conversationHistory, setConversationHistory] = useState\u003cArray\u003c{ role: 'user' | 'assistant'; content: string }\u003e\u003e([]);\nconst [loading, setLoading] = useState(false);\nconst [saving, setSaving] = useState(false);\nconst [error, setError] = useState('');\n```\n\n**Security: Sanitize recipients before display**:\n```typescript\n// In JSX\n\u003cdiv\u003e\n  \u003cstrong\u003eTo:\u003c/strong\u003e {recipients.to.map(email =\u003e encodeURIComponent(email)).join(', ')}\n\u003c/div\u003e\n{recipients.cc.length \u003e 0 \u0026\u0026 (\n  \u003cdiv\u003e\n    \u003cstrong\u003eCC:\u003c/strong\u003e {recipients.cc.map(email =\u003e encodeURIComponent(email)).join(', ')}\n  \u003c/div\u003e\n)}\n```\n\n**UI Structure** (same as ThreadDetail.tsx):\n1. Instruction textarea (when no draft)\n2. Generate button\n3. Draft preview box (blue background)\n4. Recipient display (To/CC with sanitization)\n5. Subject display (read-only)\n6. Feedback textarea (for iteration)\n7. Regenerate button\n8. Action buttons (Cancel + Approve)\n\n**Time estimate**: 2 hours\n\n### Phase 3: Testing \u0026 Verification (2 tasks)\n\n#### Task 3.1: Write Basic Tests\n**Files**:\n- `app/api/compose/route.test.ts` - Happy path + error handling\n- `app/api/compose/save/route.test.ts` - Happy path + validation\n- `app/inbox/ComposeForm.test.tsx` - Renders, calls API, shows errors\n\n**Test Coverage** (behavior-focused, not metric-focused):\n- ✅ API returns validated response\n- ✅ API handles malformed JSON from AI\n- ✅ Component renders instruction textarea\n- ✅ Component shows draft after generation\n- ✅ Component shows errors on API failure\n- ✅ Save endpoint validates recipients\n\n**Time estimate**: 1 hour\n\n#### Task 3.2: Manual End-to-End Testing\n**Dev server**: `npm run dev`\n\n**Test Scenarios**:\n1. ✅ Click FAB → modal opens\n2. ✅ Enter: \"Email john@example.com about Q1 results\"\n3. ✅ Draft generates with subject, body, recipients\n4. ✅ Provide feedback: \"Make it shorter\"\n5. ✅ Draft regenerates\n6. ✅ Click Approve → saves to Gmail\n7. ✅ Modal closes\n8. ✅ Open Gmail → verify draft exists\n\n**Edge Cases**:\n- Invalid instruction (AI handles gracefully)\n- No recipients mentioned (AI explains in body)\n- Network failure (error message shows)\n- Close modal mid-generation (request cancelled)\n\n**Time estimate**: 30 minutes\n\n## Critical Files Reference\n\n### Files to Create (7 new files)\n1. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/route.ts`\n2. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/route.test.ts`\n3. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/save/route.ts`\n4. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/save/route.test.ts`\n5. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeFAB.tsx`\n6. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeModal.tsx`\n7. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ComposeForm.tsx`\n\n### Files to Modify (1 file)\n1. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ThreadList.tsx` - Add ComposeFAB import and component at end\n\n### Files to Reference (patterns to follow)\n1. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/inbox/ThreadDetail.tsx` - Iteration UI pattern\n2. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/drafts/route.ts` - API structure\n3. `/Users/benigeri/Projects/productiviy-system/email-workflow/app/api/drafts/save/route.ts` - Nylas draft save\n\n### Files NOT Created (eliminated from plan)\n- ❌ `lib/email-parser.ts` - Not needed (AI returns structured JSON)\n- ❌ `lib/email-parser.test.ts` - Not needed\n- ❌ `app/inbox/ComposeForm.test.tsx` - Keep minimal (one smoke test only)\n\n## Verification \u0026 Testing\n\n### End-to-End Verification\n\n**Start dev server**:\n```bash\ncd /Users/benigeri/Projects/productiviy-system/email-workflow\nnpm run dev\n```\n\n**Test in browser** (http://localhost:3000):\n1. Navigate to inbox\n2. Verify FAB appears (bottom-right blue circle with pencil icon)\n3. Click FAB → modal opens\n4. Enter: \"Email john@example.com and cc jane@example.com about Q1 financial results\"\n5. Click \"Generate Draft\"\n6. Verify draft displays:\n   - Subject line (e.g., \"Q1 Financial Results\")\n   - Email body with greeting and content\n   - To: john@example.com\n   - CC: jane@example.com\n7. Enter feedback: \"Make it more concise\"\n8. Click \"Regenerate Draft\"\n9. Verify draft updates\n10. Click \"Approve \u0026 Send to Gmail\"\n11. Verify modal closes\n12. Open Gmail → verify draft exists in Drafts folder with correct recipients/subject/body\n\n**Test error handling**:\n1. Disconnect network\n2. Try to generate draft\n3. Verify error message: \"Failed to generate draft\" with retry option\n4. Reconnect and retry → success\n\n**Run automated tests**:\n```bash\nnpm run test\nnpm run lint\nnpm run build\n```\n\n### Definition of Done\n\n- [ ] FAB appears on inbox list page (bottom-right)\n- [ ] Clicking FAB opens modal with compose form\n- [ ] User can enter brief and generate draft\n- [ ] Recipients extracted correctly (to/cc) with sanitization\n- [ ] Subject line generated and displayed\n- [ ] User can provide feedback and regenerate\n- [ ] User can approve and save to Gmail\n- [ ] Draft appears in Gmail Drafts folder correctly\n- [ ] Modal closes after save\n- [ ] Error handling works (network, API, validation)\n- [ ] Basic tests pass\n- [ ] Linting passes\n- [ ] Build succeeds\n\n## Design Decisions \u0026 Rationale\n\n### Why No Email Parser?\n**Decision**: Trust AI JSON output directly\n\n**Rationale** (DHH/Simplicity feedback):\n- AI already returns structured JSON with recipients\n- Parsing strings adds unnecessary complexity (169 LOC)\n- If AI returns bad data, that's a prompt problem, not a parsing problem\n- Nylas API validates emails on save anyway\n\n### Why No localStorage?\n**Decision**: Component state only, clear on modal close\n\n**Rationale** (DHH/Simplicity feedback):\n- Reply drafts need persistence (user switches between threads)\n- Compose drafts don't (user stays in modal until done or cancelled)\n- AI can regenerate a draft in 3-5 seconds if needed\n- Simplifies state management (80 LOC saved)\n\n### Why No BCC in MVP?\n**Decision**: Support To and CC only\n\n**Rationale** (DHH feedback):\n- No evidence users need BCC for compose\n- Add when first user requests it\n- Reduces complexity (30 LOC)\n\n### Why Static Draft ID?\n**Decision**: Use \"compose-draft\" not `compose-${timestamp}`\n\n**Rationale** (DHH feedback):\n- Only one compose draft at a time\n- Timestamps as IDs are a code smell\n- Simpler to reason about\n\n### Why Keep Two Endpoints?\n**Decision**: Separate `/api/compose` and `/api/compose/save`\n\n**Rationale**:\n- Clear separation of concerns (generation vs persistence)\n- Easier to test independently\n- Matches existing pattern (`/api/drafts` and `/api/drafts/save`)\n- Simplicity reviewer suggested merging, but kept separate for clarity\n\n## What We're NOT Building (Out of Scope)\n\n**Explicitly Cut from MVP**:\n- ❌ BCC recipients (add when requested)\n- ❌ Recipient editing UI (v2 - users can iterate with feedback)\n- ❌ Subject editing (v2 - users can iterate with feedback)\n- ❌ localStorage persistence (not needed for compose)\n- ❌ Conversation history UI display (tracked internally but not shown)\n- ❌ Email validation library (trust AI + Nylas)\n- ❌ Multi-draft support (one at a time only)\n- ❌ Attachments (v2)\n- ❌ Rich text formatting (v2)\n- ❌ Templates (v2)\n\n## Time Estimates\n\n### Total Implementation Time: ~6 hours\n\n**Backend (2.5 hours)**:\n- Braintrust prompt: 10 min\n- POST /api/compose: 1 hour\n- POST /api/compose/save: 45 min\n- Basic API tests: 45 min\n\n**Frontend (3 hours)**:\n- ComposeFAB: 15 min\n- ComposeModal: 20 min\n- ComposeForm: 2 hours\n- Integration: 15 min\n- Basic component tests: 30 min\n\n**Testing \u0026 QA (30 min)**:\n- Manual E2E testing: 30 min\n\n**Reality Check**: Add 50% buffer for debugging, edge cases, and polish = ~9 hours total\n\nThis is realistic for a single developer with the existing codebase patterns.\n\n## Security Fixes (Essential Only)\n\n### 1. Zod Validation of AI Responses\n**Why**: Prevents runtime crashes from malformed JSON, validates data types\n\n**Implementation** (already in plan):\n```typescript\nconst ComposeResponseSchema = z.object({\n  subject: z.string().min(1).max(200),\n  body: z.string().min(1).max(50000),\n  to: z.array(z.string()).min(0).max(20),\n  cc: z.array(z.string()).default([]),\n});\n\nconst parsed = ComposeResponseSchema.safeParse(aiResponse);\nif (!parsed.success) {\n  return NextResponse.json({ error: 'Invalid AI response' }, { status: 500 });\n}\n```\n\n### 2. Sanitize Email Addresses for Display\n**Why**: Basic XSS protection when rendering user/AI-provided emails\n\n**Implementation** (simple, no library needed):\n```typescript\n// In ComposeForm JSX\n{recipients.to.map(email =\u003e encodeURIComponent(email)).join(', ')}\n```\n\n**Note**: This is basic sanitization. Nylas API will do full validation on save.\n\n### What We're NOT Doing (Deferred to v2):\n- ❌ Battle-tested email validation library (Nylas validates on save)\n- ❌ Content Security Policy headers (out of scope for feature work)\n- ❌ Rate limiting (app-level concern, not feature-level)\n- ❌ CSRF protection (Next.js handles this)\n\n## Summary\n\nThis simplified plan implements compose email in ~6-9 hours by:\n\n1. **Cutting unnecessary abstractions** (email parser, localStorage persistence, BCC)\n2. **Reusing proven patterns** (ThreadDetail iteration UI, existing API structure)\n3. **Adding essential security** (Zod validation, basic sanitization)\n4. **Testing behavior** (not coverage metrics)\n5. **Shipping vertical slices** (working feature end-to-end)\n\n**Total: 7 new files, 1 modified file, ~600 lines of implementation code**\n\nCompared to original plan: **-350 LOC, -2 files, -9 tasks**\n\nThe feature delivers the core value (AI-powered email composition) without gold-plating or premature optimization.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-11T00:27:17.386561-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:31:41.418963-05:00"}
{"id":"ps-8","title":"Backend: Create Braintrust compose prompt","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 1.1\n\n**Objective**: Set up Braintrust prompt for AI email composition with recipient extraction.\n\n**Implementation Details**:\n- Location: Braintrust dashboard (web UI)\n- Slug: email-compose-v1\n- Add env var: BRAINTRUST_COMPOSE_SLUG=email-compose-v1\n\n**System Prompt Structure**:\n- Extract recipients (to/cc) from user instruction\n- Return JSON: { subject, body, to[], cc[] }\n- Handle iteration with previous_draft context\n- Professional tone by default\n\n**Time Estimate**: 10 minutes\n\n**Context**: This is the first task in implementing the compose email feature. Read the full plan for complete context before starting.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:27:28.891532-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:27:28.891532-05:00","dependencies":[{"issue_id":"ps-8","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.735306-05:00","created_by":"import"}]}
{"id":"ps-9","title":"Backend: Implement POST /api/compose endpoint","description":"**Plan Reference**: See plans/2026-01-11-compose-email-feature.md - Task 1.2\n\n**Objective**: Create API endpoint that generates email drafts using AI with recipient extraction.\n\n**File**: /Users/benigeri/Projects/productiviy-system/email-workflow/app/api/compose/route.ts\n\n**Key Requirements**:\n- Zod request schema: instructions (string), conversationHistory (optional)\n- Zod response schema: subject, body, to[], cc[] (CRITICAL for security)\n- Call Braintrust invoke() with email-compose-v1 slug\n- Validate AI response with Zod (prevents crashes from malformed JSON)\n- Handle JSON parsing errors gracefully\n\n**Error Handling**:\n- Invalid JSON from AI → 500 error\n- Missing recipients → valid response with empty arrays\n- Validation failure → 400 with Zod details\n\n**Time Estimate**: 1 hour\n\n**Test File**: app/api/compose/route.test.ts (create with this task)\n\n**Context**: Read full plan for complete implementation details and error handling patterns.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-11T00:27:38.250769-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:27:38.250769-05:00","dependencies":[{"issue_id":"ps-9","depends_on_id":"ps-7","type":"blocks","created_at":"2026-01-11T00:41:26.735942-05:00","created_by":"import"}]}
{"id":"ps05h","title":"nylas-webhook: deploy \u0026 register with Nylas","description":"Deploy and register webhook:\n1. Deploy edge function to Supabase\n2. Register webhook with Nylas: POST /webhooks/\n   - trigger_types: [message.updated, message.created]\n   - webhook_url: Supabase function URL\n3. Test with real Gmail label changes\n4. Add NYLAS_WEBHOOK_SECRET to Supabase secrets","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:27:59.938964-05:00","created_by":"benigeri","updated_at":"2026-01-07T15:54:27.730319-05:00","closed_at":"2026-01-07T15:54:27.730319-05:00","close_reason":"Deployed nylas-webhook edge function, registered with Nylas, and fixed folder ID bug. Verified with real Gmail test.","dependencies":[{"issue_id":"ps05h","depends_on_id":"psalf","type":"blocks","created_at":"2026-01-07T11:28:29.866354-05:00","created_by":"benigeri"}]}
{"id":"ps0so","title":"Create /compose-email skill for net-new emails","description":"Add compose feature to email workflow web app (https://email-workflow-phi.vercel.app). Allow users to create new emails from scratch, not just reply to existing threads. Implementation: Add /compose route with form for To/CC/Subject/Body, use existing Braintrust draft generation API, reuse Nylas draft creation logic from /api/drafts route.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T19:29:17.585805-05:00","created_by":"benigeri","updated_at":"2026-01-10T13:33:13.134265-05:00"}
{"id":"ps0sq","title":"Create core capture pipeline (_shared/lib/capture.ts)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T08:21:15.497705-05:00","created_by":"benigeri","updated_at":"2026-01-06T08:39:05.548873-05:00","closed_at":"2026-01-06T08:39:05.548873-05:00","close_reason":"Implemented captureToLinear() with tests - 6 passing tests"}
{"id":"ps11s","title":"Debug Nylas webhook not triggering on label changes","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-08T15:59:18.382734-05:00","created_by":"benigeri","updated_at":"2026-01-08T17:31:42.355105-05:00","closed_at":"2026-01-08T17:31:42.355105-05:00","close_reason":"Webhook is working as designed. Triggers on message.created/updated for cleanup/deduplication. Does not ADD labels - only removes them (archive, send, dedup scenarios). Verified: function ACTIVE, Nylas webhook ACTIVE."}
{"id":"ps126","title":"Email workflow: Draft mismatch between panel and Gmail","description":"## Problem\nAI is called twice during draft workflow - once for display, once on approve.\nThis produces different drafts due to AI non-determinism.\n\n## Solution\nSingle generation + temp file storage. See docs/email-workflow-improvements.md Issue #1.\n\n## Implementation\n- Update SKILL.md workflow to use temp file pattern\n- Generate once → /tmp/email-draft-{THREAD_ID}.json\n- Display from file, send from file, cleanup after\n\n## Dependencies\n- Depends on: psmhg (dictation arg needed first)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T22:27:19.449081-05:00","created_by":"benigeri","updated_at":"2026-01-08T08:32:10.649716-05:00","closed_at":"2026-01-08T08:32:10.649716-05:00","close_reason":"Temp file pattern implemented in SKILL.md (PR #38). Draft stored to /tmp/email-draft-{THREAD_ID}.json ensures same draft shown in panel goes to Gmail.","dependencies":[{"issue_id":"ps126","depends_on_id":"psmhg","type":"blocks","created_at":"2026-01-08T08:15:46.606597-05:00","created_by":"benigeri"}]}
{"id":"ps16p","title":"Linear task → drafted email workflow","description":"Build integration to go from a Linear task directly to a drafted email response.\n\nRequires:\n- Shared services between email workflow and Linear\n- Task context extraction (assignee, description, linked threads)\n- Email drafting with task context\n- Possibly bidirectional: email replies that update Linear tasks\n\nBig feature - needs architecture planning first.","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-08T20:22:02.189959-05:00","created_by":"benigeri","updated_at":"2026-01-08T20:22:02.189959-05:00"}
{"id":"ps16s","title":"Initialize Supabase in repo","description":"Run supabase init and supabase functions new telegram-webhook to scaffold the project","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T11:00:21.716008-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:01:13.214477-05:00","closed_at":"2026-01-05T13:01:13.214477-05:00","close_reason":"Supabase initialized, PR #6 created"}
{"id":"ps1e8","title":"Refactor create-issue to use DI + captureToLinear()","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T08:21:19.073001-05:00","created_by":"benigeri","updated_at":"2026-01-06T09:18:38.504239-05:00","closed_at":"2026-01-06T09:18:38.504239-05:00","close_reason":"Closed","dependencies":[{"issue_id":"ps1e8","depends_on_id":"ps0sq","type":"blocks","created_at":"2026-01-06T08:21:26.746437-05:00","created_by":"benigeri"}]}
{"id":"ps1ex","title":"/handle-to-respond-paul-emails skill","description":"Create /handle-to-respond-paul-emails skill:\n1. Fetch emails with to-respond-paul label\n2. Show count, display first email (full context)\n3. Get user dictation → generate draft with Claude\n4. Create draft via Nylas (with reply_to_message_id)\n5. Update labels: remove to-respond-paul, add drafted\n6. Commands: next (show next), skip (keep label, next), done (exit)\n7. Placeholder email-writing-guidelines.md for later","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T11:28:01.168082-05:00","created_by":"benigeri","updated_at":"2026-01-07T16:12:51.55275-05:00","closed_at":"2026-01-07T16:12:51.55275-05:00","close_reason":"Created skill and command. PR #32. Verified API works - fetched 10 emails.","dependencies":[{"issue_id":"ps1ex","depends_on_id":"ps05h","type":"blocks","created_at":"2026-01-07T11:28:32.531115-05:00","created_by":"benigeri"}]}
{"id":"ps1tx","title":"Create message_mappings table in Supabase","description":"Milestone 2: Create Supabase table for telegram_msg_id → linear_issue_id mapping","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T11:00:51.817968-05:00","created_by":"benigeri","updated_at":"2026-01-05T11:00:51.817968-05:00"}
{"id":"ps28m","title":"Show draft in tmux panel only, not in Claude conversation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T15:59:30.222651-05:00","created_by":"benigeri","updated_at":"2026-01-08T17:38:22.808444-05:00","closed_at":"2026-01-08T17:38:22.808444-05:00","close_reason":"Implemented in feature/ux-improvements branch"}
{"id":"ps2aq","title":"Set up testing infrastructure for email-workflow","description":"## Problem\nEmail-workflow project has zero testing infrastructure. Cannot write tests without Jest/Vitest setup. CLAUDE.md requires TDD but we have no way to run tests.\n\n## What's Needed\n\n### Phase 1: Testing Infrastructure Setup (1-2 hours)\n1. Install dependencies:\n   ```bash\n   npm install --save-dev jest @jest/globals @testing-library/react @testing-library/react-hooks @testing-library/jest-dom jest-environment-jsdom\n   ```\n\n2. Create jest.config.js for Next.js:\n   ```js\n   const nextJest = require('next/jest')\n   const createJestConfig = nextJest({ dir: './' })\n   const customJestConfig = {\n     setupFilesAfterEnv: ['\u003crootDir\u003e/jest.setup.js'],\n     testEnvironment: 'jest-environment-jsdom',\n     moduleNameMapper: { '^@/(.*)$': '\u003crootDir\u003e/$1' },\n   }\n   module.exports = createJestConfig(customJestConfig)\n   ```\n\n3. Add test script to package.json:\n   ```json\n   \"test\": \"jest\",\n   \"test:watch\": \"jest --watch\",\n   \"test:coverage\": \"jest --coverage\"\n   ```\n\n4. Create jest.setup.js with globals\n\n### Phase 2: Write Tests (4-6 hours)\n- Create lib/conversation.test.ts (comprehensive)\n- Create hooks/useConversation.test.tsx\n- Mock localStorage properly\n- Test all edge cases (corrupted data, quota, SSR, race conditions)\n- Achieve \u003e80% coverage\n\n## Acceptance Criteria\n- [ ] Jest + React Testing Library installed and configured\n- [ ] npm test runs successfully\n- [ ] conversation.test.ts created with comprehensive tests\n- [ ] useConversation.test.tsx created\n- [ ] All tests pass\n- [ ] Coverage report shows \u003e80%\n- [ ] CI pipeline configured to run tests\n\n## Resources\n- Todo file: todos/004-pending-p1-add-test-coverage-conversation-management.md\n- PR #60: https://github.com/benigeri/productiviy-system/pull/60\n- Next.js testing docs: https://nextjs.org/docs/testing\n\n## Effort\n6-8 hours total (setup + tests)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T18:56:35.206288-05:00","created_by":"benigeri","updated_at":"2026-01-10T23:18:33.699055-05:00","closed_at":"2026-01-10T23:18:33.699055-05:00","close_reason":"Testing infrastructure complete. Added 36 comprehensive tests (22 for lib/conversation.ts, 14 for hooks/useConversation.ts). Covers SSR, localStorage, Zod validation, quota handling, React hooks, and edge cases. PR #70 created."}
{"id":"ps2dy","title":"Fix XSS vulnerability in ThreadDetail conversation rendering","description":"## Problem\nOWASP A03 injection vulnerability. Unescaped content in ThreadDetail.tsx allows arbitrary JavaScript execution. Can steal session data, exfiltrate conversations.\n\n## Solution\nUse React text escaping (stripHtml function) + add CSP headers. Content is plain text, not HTML.\n\n## Acceptance Criteria\n- All user-generated content sanitized before rendering\n- All assistant-generated content sanitized\n- XSS test vectors do not execute\n- CSP headers block inline scripts\n\n## Resources\n- Todo file: todos/003-pending-p1-fix-xss-vulnerability-unescaped-content.md\n- PR #60: https://github.com/benigeri/productiviy-system/pull/60\n- File: email-workflow/app/inbox/ThreadDetail.tsx (lines 129, 152-154, 193)\n\n## Effort\n15 min - 1 hour","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T18:51:45.089845-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:57:20.037096-05:00","closed_at":"2026-01-10T19:57:20.037096-05:00","close_reason":"XSS vulnerability already mitigated. Verified no dangerouslySetInnerHTML in codebase. All content rendered via React's automatic escaping ({msg.content} and {draft}). React escapes HTML by default, preventing XSS."}
{"id":"ps2e5","title":"Test skill end-to-end workflow","description":"Run through complete skill workflow to verify functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.568479-05:00","updated_at":"2026-01-06T18:44:06.372926-05:00","closed_at":"2026-01-06T18:44:06.372926-05:00","close_reason":"E2E test passed: created/deleted test Sleep event via API","dependencies":[{"issue_id":"ps2e5","depends_on_id":"ps5r9","type":"parent-child","created_at":"2026-01-06T08:42:03.060497-05:00","created_by":"benigeri"},{"issue_id":"ps2e5","depends_on_id":"psv31","type":"blocks","created_at":"2026-01-06T08:42:08.477153-05:00","created_by":"benigeri"},{"issue_id":"ps2e5","depends_on_id":"pszgh","type":"blocks","created_at":"2026-01-06T08:42:08.513795-05:00","created_by":"benigeri"}]}
{"id":"ps2fb","title":"E2E test and cleanup: re-run workflow, verify fixes, archive docs","description":"Final verification: 1) Re-run email workflow end-to-end with user driving, 2) Verify all bug fixes work, 3) Archive/cleanup E2E-BUGS.md and IMPROVEMENT-PLAN.md once verified. This is the final task before closing the epic.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T10:22:53.986015-05:00","created_by":"benigeri","updated_at":"2026-01-09T23:07:38.041945-05:00","closed_at":"2026-01-09T23:07:38.041945-05:00","close_reason":"E2E testing complete. All bugs fixed: hotkeys work, display clean, formatting good. PR #57 created.","dependencies":[{"issue_id":"ps2fb","depends_on_id":"psi3u","type":"blocks","created_at":"2026-01-08T10:23:07.558192-05:00","created_by":"benigeri"},{"issue_id":"ps2fb","depends_on_id":"psg3c","type":"blocks","created_at":"2026-01-08T10:23:07.626301-05:00","created_by":"benigeri"},{"issue_id":"ps2fb","depends_on_id":"psa5j","type":"blocks","created_at":"2026-01-08T10:23:07.68392-05:00","created_by":"benigeri"}]}
{"id":"ps2m4","title":"Email Workflow: Iteration UI Improvements","description":"Add draft iteration, Skip/Approve buttons, and shadcn UI to email workflow web app.\n\n**Current Issues:**\n- Drafts auto-save to Gmail immediately (should only save on Approve)\n- No feedback/iteration loop for refining drafts\n- No Skip/Approve buttons\n- Plain HTML forms (need shadcn for better UX)\n\n**New Flow:**\n1. View thread → Enter instructions → Generate draft\n2. Draft preview appears with feedback textbox\n3. User can iterate: give feedback → regenerate → review\n4. Click Skip: go to next email (no draft saved)\n5. Click Approve: save to Gmail, update labels, auto-advance\n\n**Technical:**\n- Conversation state in localStorage per thread\n- shadcn components (Button, Card, Textarea, Input)\n- Refactor API: /api/drafts POST (generate only), PUT (approve \u0026 save)\n- No auto-save until Approve clicked\n\n**Dependencies:** All sub-beads for implementation phases","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-10T16:30:19.40216-05:00","created_by":"benigeri","updated_at":"2026-01-10T20:01:19.366621-05:00","closed_at":"2026-01-10T20:01:19.366621-05:00","close_reason":"All 5 sub-tasks completed:\n✅ Conversation state management (8a4)\n✅ shadcn UI installed (rbm)\n✅ Skip/Approve buttons with navigation (n0i)\n✅ Draft feedback/iteration loop (ohj)\n✅ Refactored draft generation (no auto-save) (xhs)\n\nNew flow working: View thread → Generate draft → Iterate with feedback → Skip or Approve → Auto-advance. Draft only saves to Gmail on Approve.","dependencies":[{"issue_id":"ps2m4","depends_on_id":"psrbm","type":"blocks","created_at":"2026-01-10T16:36:04.622282-05:00","created_by":"benigeri"},{"issue_id":"ps2m4","depends_on_id":"ps8a4","type":"blocks","created_at":"2026-01-10T16:36:04.668651-05:00","created_by":"benigeri"},{"issue_id":"ps2m4","depends_on_id":"psxhs","type":"blocks","created_at":"2026-01-10T16:36:04.710144-05:00","created_by":"benigeri"},{"issue_id":"ps2m4","depends_on_id":"psn0i","type":"blocks","created_at":"2026-01-10T16:36:04.747721-05:00","created_by":"benigeri"},{"issue_id":"ps2m4","depends_on_id":"psohj","type":"blocks","created_at":"2026-01-10T16:36:04.784756-05:00","created_by":"benigeri"}]}
{"id":"ps31r","title":"Fix HTTP method semantics: PUT should be POST for draft save","description":"**Bug**: Using PUT to create new Gmail drafts violates REST conventions. PUT should be idempotent but this endpoint creates a new draft each time.\n\n**Location**: email-workflow/app/api/drafts/route.ts:93-168\n\n**Current Behavior**:\n```typescript\nexport async function PUT(request: Request) {\n  // Creates NEW draft in Gmail each time\n  // Non-idempotent operation\n}\n```\n\n**Expected Behavior**:\n- POST for creating new resources (non-idempotent)\n- PUT for updating existing resources (idempotent)\n\n**Impact**:\n- Violates HTTP standards\n- Confusing API semantics\n- Could cause duplicate drafts if client retries\n- Makes API unpredictable\n\n**Fix**:\nRename PUT to POST and move to separate route:\n```\nPOST /api/drafts/generate  // Generate draft content\nPOST /api/drafts/save      // Save to Gmail (current PUT logic)\n```\n\n**Acceptance Criteria**:\n- [ ] PUT endpoint removed\n- [ ] New POST /api/drafts/save route created\n- [ ] Client updated to call new endpoint\n- [ ] All functionality works (save + label update + navigation)\n- [ ] API follows REST conventions\n\n**Resources**:\n- Todo: todos/008-pending-p0-fix-http-method-semantics-put-to-post.md\n- Review findings: .claude/plans/pr-61-fix-plan.md","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T19:29:10.079973-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:44:27.012634-05:00","closed_at":"2026-01-10T19:44:27.012634-05:00","close_reason":"Fixed HTTP method semantics: moved PUT to POST at /api/drafts/save endpoint. Client now calls POST /api/drafts/save for creating drafts in Gmail."}
{"id":"ps3ee","title":"Add localStorage quota management and cleanup","description":"Implement automatic cleanup of old conversation data and quota management to prevent localStorage from filling up.\n\n**Context**: PR #61 review found that conversation.ts has no size limits, TTL, or cleanup. After ~100 threads, localStorage hits 5-10MB quota and silently fails.\n\n**Problem**:\n- Conversations stored indefinitely\n- No maximum size enforcement\n- No cleanup of old data\n- Silent failure when quota exceeded\n- User loses data without warning\n\n**Scope**:\n- Add TTL to conversations (delete after 30 days)\n- Implement cleanupExpiredConversations() utility\n- Add quota check before saving (warn at 4MB)\n- Handle QuotaExceededError gracefully\n- Show warning to user when approaching quota\n- Write tests for cleanup logic\n\n**Implementation**:\n- Add timestamp-based expiration\n- Run cleanup on each setStore() call\n- Add size calculation before save\n- Retry save after cleanup if quota exceeded\n\n**Acceptance Criteria**:\n- [ ] Conversations auto-delete after 30 days\n- [ ] Quota checked before each save\n- [ ] Warning shown when \u003e4MB used\n- [ ] QuotaExceededError triggers cleanup + retry\n- [ ] Tests verify cleanup and quota handling\n\n**Resources**:\n- Data integrity review findings\n- File: email-workflow/lib/conversation.ts","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T19:22:43.778618-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:58:51.807457-05:00","closed_at":"2026-01-10T19:58:51.807457-05:00","close_reason":"Implemented in psumh fix. Quota management includes:\n- Prune conversations older than 7 days\n- Keep only last 20 conversations\n- Automatic pruning on QuotaExceededError\n- Console logging of pruning activity"}
{"id":"ps3jh","title":"Email Workflow: Build label update API","description":"Create app/api/threads/route.ts for label updates.\n\nIncludes:\n- Zod validation\n- Fetch thread to get message IDs\n- Update labels on all messages\n- Error handling\n\nFile: app/api/threads/route.ts (~30 lines)\nEstimated: 2 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:32:14.595176-05:00","created_by":"benigeri","updated_at":"2026-01-10T12:45:02.514019-05:00","closed_at":"2026-01-10T12:45:02.514019-05:00","close_reason":"Closed","dependencies":[{"issue_id":"ps3jh","depends_on_id":"psb0o","type":"blocks","created_at":"2026-01-10T12:32:29.260311-05:00","created_by":"benigeri"}]}
{"id":"ps3xb","title":"Organize productivity system into clear domains","description":"The productivity system has multiple capabilities (email workflow, calendar management, etc.) but they're not clearly separated. Consider organizing into clear domains with their own documentation: 1) Email triage workflow, 2) Calendar management, 3) Issue/task capture. Each domain should have clear entry points and documentation.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T08:32:20.383114-05:00","created_by":"benigeri","updated_at":"2026-01-09T08:32:20.383114-05:00"}
{"id":"ps4dd","title":"Write tests for linear.ts, then implement","description":"TDD: Write tests for createTriageIssue function using BEN team, then implement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:29.745861-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:24:30.538122-05:00","closed_at":"2026-01-05T13:24:30.538122-05:00","close_reason":"All tests pass for linear.ts"}
{"id":"ps4fi","title":"Email Workflow: Build inbox page","description":"Build app/inbox/page.tsx with Server Components.\n\nIncludes:\n- Server Component to fetch threads from Nylas\n- ThreadList client component for UI\n- ThreadDetail client component for messages + draft\n- Direct localStorage for session counts\n\nFile: app/inbox/page.tsx (~100 lines)\nEstimated: 1 day","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:31:58.206232-05:00","created_by":"benigeri","updated_at":"2026-01-10T12:42:54.305922-05:00","closed_at":"2026-01-10T12:42:54.305922-05:00","close_reason":"Closed","dependencies":[{"issue_id":"ps4fi","depends_on_id":"psdxe","type":"blocks","created_at":"2026-01-10T12:32:29.17185-05:00","created_by":"benigeri"}]}
{"id":"ps52r","title":"Add content sanitization to prevent XSS in email workflow","description":"Install DOMPurify and sanitize all user-generated and LLM-generated content before displaying in the UI to prevent XSS attacks.\n\n**Context**: PR #61 review found that draft content from Braintrust LLM and localStorage is displayed without sanitization. While React escapes by default, this is fragile if code is refactored.\n\n**Vulnerable Locations**:\n- ThreadDetail.tsx:304 - Draft preview content\n- ThreadDetail.tsx:128 - Email message bodies\n- ThreadDetail.tsx:152 - Conversation history messages\n\n**Scope**:\n- Install DOMPurify and @types/dompurify\n- Create lib/sanitize.ts with sanitizeText() and sanitizeHTML() utilities\n- Apply sanitization at all render points for user/LLM content\n- Add Content Security Policy headers in next.config.ts\n- Write tests for sanitization\n\n**Acceptance Criteria**:\n- [ ] DOMPurify installed and configured\n- [ ] All draft content sanitized before display\n- [ ] All message bodies sanitized\n- [ ] Conversation history sanitized\n- [ ] CSP headers configured\n- [ ] Tests verify HTML/script tags are stripped\n\n**Resources**:\n- Security review: todos/009 mentions this\n- DOMPurify docs: https://github.com/cure53/DOMPurify","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T19:22:43.148917-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:57:32.112605-05:00","closed_at":"2026-01-10T19:57:32.112605-05:00","close_reason":"React's automatic escaping is sufficient for plain text content. DOMPurify only needed when rendering HTML (dangerouslySetInnerHTML), which we don't use. React escaping is not fragile - it's the standard safe approach. Adding DOMPurify would be over-engineering."}
{"id":"ps5g6","title":"Email panel: reverse message order and add visual separation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T20:56:16.87053-05:00","created_by":"benigeri","updated_at":"2026-01-09T08:48:58.498136-05:00","closed_at":"2026-01-09T08:48:58.498136-05:00","close_reason":"Fixed in commit 0367a7a on fix/email-workflow-bugs branch"}
{"id":"ps5ls","title":"Update Edge Function to handle replies → Linear comments","description":"Milestone 2: Implement reply handling - lookup parent message, add comment to existing Linear issue","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T11:00:52.224074-05:00","created_by":"benigeri","updated_at":"2026-01-05T11:00:52.224074-05:00"}
{"id":"ps5r9","title":"[epic] Build weekly-cadence Claude Code skill","description":"Create a Claude Code skill to manage sleep blocks and workout events via Nylas Calendar API.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.565375-05:00","updated_at":"2026-01-06T18:44:06.580177-05:00","closed_at":"2026-01-06T18:44:06.580177-05:00","close_reason":"Epic complete: skill at ~/.claude/skills/weekly-cadence/ with SKILL.md and API reference"}
{"id":"ps5zq","title":"Merge PR #50: Fix duplicate command/skill names","description":"PR #50 fixes the duplicate handle-to-respond-paul registration (both command file and skill SKILL.md register it). This PR also adds a test to prevent future duplicates. Needs to be merged.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T08:32:12.880466-05:00","created_by":"benigeri","updated_at":"2026-01-09T08:48:58.486823-05:00","closed_at":"2026-01-09T08:48:58.486823-05:00","close_reason":"Fixed in commit 0367a7a on fix/email-workflow-bugs branch"}
{"id":"ps7cf","title":"Write tests for reply handling","description":"Milestone 2: TDD for reply detection, message lookup, and comment creation","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T11:00:52.024983-05:00","created_by":"benigeri","updated_at":"2026-01-05T11:00:52.024983-05:00"}
{"id":"ps7d5","title":"nylas-webhook: API client + tests","description":"TDD: Create Nylas API client in lib/nylas.ts:\n- getMessage(id): GET /grants/{id}/messages/{msg_id}\n- getThread(id): GET /grants/{id}/threads/{thread_id}\n- updateMessageFolders(id, folders): PUT /grants/{id}/messages/{msg_id}\n- getFolders(): GET /grants/{id}/folders (for label ID mapping)\n- verifyNylasSignature(signature, body, secret): HMAC-SHA256\n- Lazy load: fetch message only when needed","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:27:55.728636-05:00","created_by":"benigeri","updated_at":"2026-01-07T15:11:00.070048-05:00","closed_at":"2026-01-07T15:11:00.070048-05:00","close_reason":"Closed","dependencies":[{"issue_id":"ps7d5","depends_on_id":"pspeq","type":"blocks","created_at":"2026-01-07T11:28:25.347551-05:00","created_by":"benigeri"}]}
{"id":"ps7g1","title":"Debug clickable links in Ghostty/Agent Deck terminal","description":"URLs in session summary not clickable in Ghostty terminal with Agent Deck. Investigate: 1) OSC 8 escape sequence support in Ghostty, 2) Agent Deck terminal passthrough, 3) Alternative approaches (e.g., copy to clipboard, open command). May need show-summary.py helper script.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-08T10:54:11.853134-05:00","created_by":"benigeri","updated_at":"2026-01-08T17:38:12.463545-05:00","closed_at":"2026-01-08T17:38:12.463545-05:00","close_reason":"Investigation complete: Ghostty supports OSC 8 but escape sequences get stripped by Claude Code output pipeline. Plain URLs work with cmd-click (default Ghostty behavior). No code changes needed - the simplified session summary URL is clickable via cmd-click."}
{"id":"ps7l0","title":"Add tmux hotkeys for instant email actions (Alt+A/S/D/V)","description":"Add tmux hotkeys for instant email actions during workflow. Hotkeys: Alt+A (approve), Alt+S (skip), Alt+D (done), Alt+V (paste dictation from clipboard). Uses tmux set-buffer/paste-buffer for multi-line support. Bindings activate on panel create, deactivate on close. Files: email-hotkeys.sh (setup/teardown), panel-manager.sh (integration).","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-09T19:29:17.379192-05:00","created_by":"benigeri","updated_at":"2026-01-09T20:59:19.757963-05:00","closed_at":"2026-01-09T20:59:19.757963-05:00","close_reason":"Closed"}
{"id":"ps80h","title":"Move hard-coded Gmail label IDs to environment variables","description":"Replace hard-coded Gmail label IDs with environment variables to support multiple Gmail accounts.\n\n**Context**: PR #61 review found hard-coded label IDs (Label_215, Label_139) in route.ts that are environment-specific.\n\n**Problem**:\n- Label IDs are unique per Gmail account\n- Code breaks if labels recreated\n- Can't use in different Gmail accounts\n- No documentation of what labels mean\n\n**Current Code**:\n```typescript\naddLabels: ['Label_215'], // drafted label\nremoveLabels: ['Label_139'], // to-respond-paul label\n```\n\n**Scope**:\n- Add to .env.local:\n  - GMAIL_LABEL_DRAFTED=Label_215\n  - GMAIL_LABEL_TO_RESPOND=Label_139\n- Update .env.example with label documentation\n- Create lib/constants.ts for label constants\n- Update all references in route.ts and docs\n- Add validation that labels exist\n\n**Acceptance Criteria**:\n- [ ] Label IDs in environment variables\n- [ ] .env.example documents label purpose\n- [ ] lib/constants.ts exports typed constants\n- [ ] All hard-coded IDs replaced\n- [ ] Error if required env vars missing\n\n**Resources**:\n- Files: email-workflow/app/api/drafts/route.ts:144-145\n- File: email-workflow/app/api/threads/route.ts","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T19:22:43.929969-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:22:43.929969-05:00"}
{"id":"ps8a4","title":"Email Workflow: Add conversation state management","description":"Add localStorage-backed conversation state for draft iterations.\n\n**State structure:**\n```typescript\n{\n  [threadId]: {\n    messages: [\n      { role: 'user', content: 'Initial instructions' },\n      { role: 'assistant', content: '\u003cp\u003eDraft HTML\u003c/p\u003e' },\n      { role: 'user', content: 'Make it shorter' },\n      { role: 'assistant', content: '\u003cp\u003eShorter draft\u003c/p\u003e' }\n    ],\n    currentDraft: '\u003cp\u003eLatest draft HTML\u003c/p\u003e'\n  }\n}\n```\n\n**Implementation:**\n- Create useConversation hook\n- Load/save to localStorage\n- Clear conversation on Approve\n- Persist across page refreshes\n\n**Test:**\n- State persists on refresh\n- Cleared after approval\n- Multiple threads don't interfere","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T16:35:55.870878-05:00","created_by":"benigeri","updated_at":"2026-01-10T18:59:31.144263-05:00","closed_at":"2026-01-10T18:59:31.144263-05:00","close_reason":"PR #60 merged successfully. Conversation state management implemented with localStorage backend, Zod validation, and full UI integration. Created follow-up beads for XSS fix, quota handling, and testing infrastructure."}
{"id":"ps8gw","title":"draft-email.py: CC field returns strings instead of objects","description":"When generating drafts, the CC field sometimes returns plain email strings instead of {email, name} objects. This causes Nylas API errors (400 bad request). Workaround: transform strings to objects before sending. Fix: ensure draft-email.py always returns proper format.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T08:32:11.037743-05:00","created_by":"benigeri","updated_at":"2026-01-09T08:48:58.4957-05:00","closed_at":"2026-01-09T08:48:58.4957-05:00","close_reason":"Fixed in commit 0367a7a on fix/email-workflow-bugs branch"}
{"id":"ps8jc","title":"Email Workflow: Code Review Bug Fixes from PR #61","description":"Epic to track all bugs identified during comprehensive code review of PR #61 (Email Workflow Iteration UI).\n\n**Review Summary**:\n- 6 parallel review agents analyzed PR #61\n- 13 total issues identified\n- 8 bugs requiring fixes (P0-P1)\n- 5 enhancements/refactors deferred (P2-P3)\n\n**Bug Categories**:\n1. **API Design** - HTTP method semantics, error handling\n2. **Security** - CSRF, XSS, authentication gaps\n3. **Data Integrity** - CC recipients, label updates, race conditions\n4. **Performance** - Navigation, state management\n\n**Children**:\nWill link all bug-type issues as dependencies.\n\n**Success Criteria**:\n- [ ] All P0 bugs fixed and tested\n- [ ] All P1 bugs fixed and tested\n- [ ] PR #61 can safely merge\n- [ ] No data integrity issues\n- [ ] Core security vulnerabilities addressed\n\n**Resources**:\n- PR: https://github.com/benigeri/productiviy-system/pull/61\n- Review Plan: .claude/plans/pr-61-fix-plan.md\n- Todos: todos/008-010 (P0 issues documented)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-10T19:28:23.507664-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:51:29.18036-05:00","closed_at":"2026-01-10T19:51:29.18036-05:00","close_reason":"All 5 bug fixes completed and tested:\n1. HTTP method semantics - PUT→POST for draft save\n2. Label update error handling - retry logic with exponential backoff\n3. CC recipients - filters self from CC list\n4. Race condition - useEffect syncs draft state\n5. Navigation - router.push replaces window.location\n\nTests: Vitest framework set up with 5 passing tests covering issues #4, #5, #6.","dependencies":[{"issue_id":"ps8jc","depends_on_id":"ps31r","type":"blocks","created_at":"2026-01-10T19:29:18.007763-05:00","created_by":"benigeri"},{"issue_id":"ps8jc","depends_on_id":"pscka","type":"blocks","created_at":"2026-01-10T19:29:18.053831-05:00","created_by":"benigeri"},{"issue_id":"ps8jc","depends_on_id":"psb1z","type":"blocks","created_at":"2026-01-10T19:29:18.097897-05:00","created_by":"benigeri"},{"issue_id":"ps8jc","depends_on_id":"psmup","type":"blocks","created_at":"2026-01-10T19:29:18.13964-05:00","created_by":"benigeri"},{"issue_id":"ps8jc","depends_on_id":"psk5s","type":"blocks","created_at":"2026-01-10T19:29:18.197988-05:00","created_by":"benigeri"}]}
{"id":"ps8lq","title":"Create slack-webhook edge function","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T08:21:20.100689-05:00","created_by":"benigeri","updated_at":"2026-01-06T09:34:35.3323-05:00","closed_at":"2026-01-06T09:34:35.3323-05:00","close_reason":"Closed","dependencies":[{"issue_id":"ps8lq","depends_on_id":"psp9v","type":"blocks","created_at":"2026-01-06T08:21:26.819744-05:00","created_by":"benigeri"},{"issue_id":"ps8lq","depends_on_id":"ps1e8","type":"blocks","created_at":"2026-01-06T08:21:26.897276-05:00","created_by":"benigeri"}]}
{"id":"ps960","title":"Write tests for claude.ts, then implement","description":"TDD: Write tests for cleanupContent function including edge cases, then implement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:29.554419-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:23:29.367995-05:00","closed_at":"2026-01-05T13:23:29.367995-05:00","close_reason":"All tests pass for claude.ts"}
{"id":"ps96g","title":"Show recipients before generating draft","description":"After user dictates, show likely To/CC recipients before generating full draft. Allows user to adjust if needed. See: .claude/skills/email-respond/IMPROVEMENT-PLAN.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T10:19:48.98899-05:00","created_by":"benigeri","updated_at":"2026-01-08T11:00:17.692369-05:00","closed_at":"2026-01-08T11:00:17.692369-05:00","close_reason":"Added recipient confirmation step to SKILL.md workflow before draft generation"}
{"id":"ps9lx","title":"Email workflow: Create draft-email.py Anthropic wrapper","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T21:03:25.036645-05:00","created_by":"benigeri","updated_at":"2026-01-07T21:28:18.975412-05:00","closed_at":"2026-01-07T21:28:18.975412-05:00","close_reason":"Merged PR #33. draft-email.py fetches thread via Nylas Clean Messages API and generates draft response with Anthropic.","dependencies":[{"issue_id":"ps9lx","depends_on_id":"psoc8","type":"blocks","created_at":"2026-01-07T21:03:38.306229-05:00","created_by":"benigeri"}]}
{"id":"ps9oa","title":"Simplify session summary to single drafts link","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T15:59:29.820141-05:00","created_by":"benigeri","updated_at":"2026-01-08T17:38:22.810217-05:00","closed_at":"2026-01-08T17:38:22.810217-05:00","close_reason":"Implemented in feature/ux-improvements branch"}
{"id":"psa5j","title":"Fix line breaks in draft preview (Bug #7)","description":"Line breaks missing in tmux preview. Fix: Update sed to preserve \u003cbr\u003e and \u003c/p\u003e as newlines before stripping HTML. See: .claude/skills/email-respond/IMPROVEMENT-PLAN.md","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T10:19:37.918809-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:31:19.499975-05:00","closed_at":"2026-01-08T10:31:19.499975-05:00","close_reason":"Fixed HTML to text conversion in panel-manager.sh to preserve line breaks"}
{"id":"psa90","title":"Add secrets to Supabase","description":"Set TELEGRAM_BOT_TOKEN, LINEAR_API_KEY, DEEPGRAM_API_KEY, ANTHROPIC_API_KEY via supabase secrets set","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:38.637818-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:49:39.989514-05:00","closed_at":"2026-01-05T13:49:39.989514-05:00","close_reason":"Closed"}
{"id":"psac7","title":"Improve MCP server documentation and setup guide","description":"Create comprehensive documentation for the lever-remote MCP server including:\n- Setup instructions for Mac users\n- One-line install command\n- Explanation of machine-level vs account-level config\n- Troubleshooting guide\n- How to verify the MCP server is working\n- Example usage in Claude desktop app\n\nCurrent gap: Users need to manually understand the config file structure and there's no easy way to share the setup with others.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T18:12:19.726325-05:00","created_by":"benigeri","updated_at":"2026-01-10T18:12:27.709495-05:00"}
{"id":"psac8","title":"Email workflow: Test end-to-end flow","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T21:03:25.76298-05:00","created_by":"benigeri","updated_at":"2026-01-09T23:07:38.052378-05:00","closed_at":"2026-01-09T23:07:38.052378-05:00","close_reason":"E2E testing complete. All bugs fixed: hotkeys work, display clean, formatting good. PR #57 created.","dependencies":[{"issue_id":"psac8","depends_on_id":"psngo","type":"blocks","created_at":"2026-01-07T21:03:38.477463-05:00","created_by":"benigeri"},{"issue_id":"psac8","depends_on_id":"psb65","type":"blocks","created_at":"2026-01-08T10:48:03.980255-05:00","created_by":"benigeri"}]}
{"id":"psagg","title":"Create weekly-cadence skill directory structure","description":"Set up the skill directory at `~/.claude/skills/weekly-cadence/`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.567399-05:00","updated_at":"2026-01-06T18:40:32.861807-05:00","closed_at":"2026-01-06T18:40:32.861807-05:00","close_reason":"Env vars in .zshrc, directory at ~/.claude/skills/weekly-cadence/","dependencies":[{"issue_id":"psagg","depends_on_id":"ps5r9","type":"parent-child","created_at":"2026-01-06T08:42:02.676218-05:00","created_by":"benigeri"}]}
{"id":"psalf","title":"nylas-webhook: handler + tests","description":"TDD: Create webhook handler in index.ts:\n- Challenge verification (GET with challenge param)\n- Signature verification (x-nylas-signature header)\n- Route message.updated and message.created events\n- Async processing: return 200 immediately, process in background\n- Idempotent: clearOtherWorkflowLabels(messageId, keepLabel)\n- Triggers: label added, reply sent, message archived (INBOX removed)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:27:58.740978-05:00","created_by":"benigeri","updated_at":"2026-01-07T15:19:47.053632-05:00","closed_at":"2026-01-07T15:19:47.053632-05:00","close_reason":"Closed","dependencies":[{"issue_id":"psalf","depends_on_id":"ps7d5","type":"blocks","created_at":"2026-01-07T11:28:27.484295-05:00","created_by":"benigeri"},{"issue_id":"psalf","depends_on_id":"psl9c","type":"blocks","created_at":"2026-01-07T11:28:27.584799-05:00","created_by":"benigeri"}]}
{"id":"psb0o","title":"Email Workflow: Build draft API route","description":"Create app/api/drafts/route.ts for draft generation + save.\n\nIncludes:\n- Zod validation for request\n- Braintrust invoke for LLM draft generation\n- Nylas API call to create Gmail draft\n- Update labels (call /api/threads)\n- Error handling with logging\n\nFile: app/api/drafts/route.ts (~80 lines)\nEstimated: 1 day","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:32:04.015684-05:00","created_by":"benigeri","updated_at":"2026-01-10T12:44:15.861937-05:00","closed_at":"2026-01-10T12:44:15.861937-05:00","close_reason":"Closed","dependencies":[{"issue_id":"psb0o","depends_on_id":"ps4fi","type":"blocks","created_at":"2026-01-10T12:32:29.220832-05:00","created_by":"benigeri"}]}
{"id":"psb1e","title":"[epic] Email Workflow: Security Hardening","description":"Implement comprehensive security measures for email workflow API. Includes CSRF protection for state-changing operations and authentication middleware to prevent unauthorized access. Critical for production deployment.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-10T20:00:23.079351-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:32:20.706585-05:00","dependencies":[{"issue_id":"psb1e","depends_on_id":"pswy4","type":"blocks","created_at":"2026-01-10T20:00:32.288892-05:00","created_by":"benigeri"},{"issue_id":"psb1e","depends_on_id":"psid1","type":"blocks","created_at":"2026-01-10T20:00:32.32638-05:00","created_by":"benigeri"}]}
{"id":"psb1z","title":"Fix CC recipients logic dropping original email recipients","description":"**Bug**: Reply CC logic incorrectly assumes first recipient in 'to' field is the sender, causing original recipients to be dropped from the reply.\n\n**Location**: email-workflow/app/inbox/ThreadDetail.tsx:174\n\n**Current Code**:\n```typescript\ncc: lastMessage.to.slice(1), // ❌ WRONG - drops recipients\n```\n\n**Reproduction**:\n1. Original email: To: bob@example.com, charlie@example.com\n2. Reply created with current logic\n3. Result: To: alice@example.com (from), CC: charlie@example.com\n4. **Bob is completely missing from the reply\\!**\n\n**Expected Behavior**:\n```typescript\n// Include all original recipients except yourself\nconst myEmail = 'your-email@example.com';\nconst replyCc = [\n  ...lastMessage.to,\n  ...(lastMessage.cc || [])\n].filter(addr =\u003e addr.email \\!== myEmail);\n```\n\n**Impact**:\n- Missing people on reply emails\n- Communication breakdown\n- Data loss (recipient information)\n- User trust issues\n\n**Acceptance Criteria**:\n- [ ] All original To recipients included in reply\n- [ ] All original CC recipients included\n- [ ] User's own email excluded from CC\n- [ ] Test verifies all recipients preserved\n- [ ] Test covers edge cases (self in To, empty CC, etc.)\n\n**Test Required**: ✅ Yes","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T19:29:10.402667-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:47:38.497204-05:00","closed_at":"2026-01-10T19:47:38.497204-05:00","close_reason":"Fixed CC recipients to include all original recipients. API now fetches grant email and filters out self from CC. Client sends all recipients (lastMessage.to), API handles filtering. Test pending."}
{"id":"psb65","title":"Add session summary with Gmail draft links","description":"At end of workflow, show summary with clickable Gmail links to review all drafts created. See: .claude/skills/email-respond/IMPROVEMENT-PLAN.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T10:19:49.50469-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:50:59.990446-05:00","closed_at":"2026-01-08T10:50:59.990446-05:00","close_reason":"Updated SKILL.md with session summary format and draft tracking"}
{"id":"psbdp","title":"Write tests for telegram.ts, then implement","description":"TDD: Write tests for parseWebhookUpdate, getFileUrl, validateWebhookSignature functions, then implement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:29.174902-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:21:24.382309-05:00","closed_at":"2026-01-05T13:21:24.382309-05:00","close_reason":"All tests pass for telegram.ts"}
{"id":"psbw2","title":"Email workflow: Update email-canvas.py for thread+draft display","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T21:03:24.714607-05:00","created_by":"benigeri","updated_at":"2026-01-07T21:45:54.982213-05:00","closed_at":"2026-01-07T21:45:54.982213-05:00","close_reason":"Merged PR #34. email-canvas.py provides terminal panel display with list, thread, and draft modes.","dependencies":[{"issue_id":"psbw2","depends_on_id":"psoc8","type":"blocks","created_at":"2026-01-07T21:03:38.255717-05:00","created_by":"benigeri"}]}
{"id":"psc1t","title":"Write tests for deepgram.ts, then implement","description":"TDD: Write tests for transcribeAudio function including error handling, then implement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:29.362493-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:22:45.330651-05:00","closed_at":"2026-01-05T13:22:45.330651-05:00","close_reason":"All tests pass for deepgram.ts"}
{"id":"psceg","title":"Create email_utils.py shared library","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-09T19:29:17.000401-05:00","created_by":"benigeri","updated_at":"2026-01-09T20:22:47.178843-05:00","closed_at":"2026-01-09T20:22:47.178843-05:00","close_reason":"Closed"}
{"id":"pscka","title":"Fix silent label update failures in approve flow","description":"**Bug**: Draft saves to Gmail successfully but label update failures are silently ignored, causing data inconsistency.\n\n**Location**: email-workflow/app/api/drafts/route.ts:136-148\n\n**Current Behavior**:\n1. Draft saves to Gmail ✓\n2. Label API call fails ✗\n3. Returns { success: true } anyway\n4. Thread stays in 'to-respond-paul' inbox\n5. User drafts it again → duplicate drafts\n\n**Expected Behavior**:\n- Label update should retry on transient failures\n- User should be warned if labels fail after retries\n- Draft should be preserved (not rolled back)\n\n**Impact**:\n- Data inconsistency (Gmail state ≠ workflow state)\n- User confusion and duplicate work\n- Broken workflow automation\n\n**Fix**:\n```typescript\n// Add retry with exponential backoff\nasync function updateLabelsWithRetry(maxRetries = 3) {\n  // Retry logic\n}\n\n// Check result and warn on failure\nif (!labelResult.success) {\n  return NextResponse.json({\n    success: true,\n    draftId: draft.data.id,\n    warning: 'Draft saved but labels not updated'\n  }, { status: 207 });\n}\n```\n\n**Acceptance Criteria**:\n- [ ] Label update has retry logic (3 attempts)\n- [ ] Failed labels return 207 with warning\n- [ ] Draft saved even if labels fail\n- [ ] User sees clear warning message\n- [ ] Error logged with draft ID for debugging\n\n**Resources**:\n- Todo: todos/010-pending-p0-fix-label-update-error-handling.md","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T19:29:10.246313-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:45:16.770097-05:00","closed_at":"2026-01-10T19:45:16.770097-05:00","close_reason":"Added retry logic with exponential backoff (3 attempts) for label updates. API now returns warning if labels fail but draft succeeds. Client logs warning to console but continues navigation."}
{"id":"psct2","title":"Get API keys: Deepgram + Anthropic","description":"Setup task: Obtain API keys for Deepgram (voice transcription) and Anthropic (Claude for title/desc cleanup)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T11:00:21.441481-05:00","created_by":"benigeri","updated_at":"2026-01-05T12:52:17.416729-05:00","closed_at":"2026-01-05T12:52:17.416729-05:00","close_reason":"Keys stored in .env and verified working"}
{"id":"pscwq","title":"Fix label update failing on threads with SENT folder","description":"update_thread_labels fails with 'unsupported Google label: SENT' when thread has system folders. Need to filter out system labels (SENT, DRAFT, etc) before updating. Draft creation works, only label update fails.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T10:39:08.998325-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:43:51.544382-05:00","closed_at":"2026-01-08T10:43:51.544382-05:00","close_reason":"Added GMAIL_SYSTEM_FOLDERS filter to exclude SENT, DRAFT, etc. from label updates"}
{"id":"psdxe","title":"Email Workflow: Setup Next.js app","description":"Create Next.js 15 app with dependencies (braintrust, zod).\n\nSetup:\n- Create app with TypeScript, Tailwind\n- Install braintrust, zod\n- Add .env.local with API keys\n- Create Braintrust prompt in dashboard\n\nFiles: package.json, .env.local\nEstimated: 4 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:31:52.2311-05:00","created_by":"benigeri","updated_at":"2026-01-10T12:39:14.051016-05:00","closed_at":"2026-01-10T12:39:14.051016-05:00","close_reason":"Closed"}
{"id":"psfce","title":"Add request cancellation with AbortController","description":"Implement AbortController to cancel in-flight API requests when user navigates away from thread detail page.\n\n**Context**: PR #61 performance review found that draft generation requests continue even after user navigates away, wasting bandwidth and API quota.\n\n**Problem**:\n- User starts draft generation\n- User navigates to next thread\n- Old request continues in background\n- Wastes Braintrust API calls\n- Response tries to update unmounted component\n\n**Scope**:\n- Add AbortController to generateDraft() function\n- Add AbortController to regenerateDraft() function\n- Cancel requests in useEffect cleanup\n- Handle AbortError gracefully (don't show error to user)\n- Write tests for cancellation behavior\n\n**Affected Functions**:\n- ThreadDetail.tsx:47-91 - generateDraft()\n- ThreadDetail.tsx:93-137 - regenerateDraft()\n\n**Acceptance Criteria**:\n- [ ] AbortController created for each request\n- [ ] Requests cancelled on component unmount\n- [ ] AbortError handled without showing error\n- [ ] Tests verify cancellation works\n- [ ] Network tab shows cancelled requests\n\n**Resources**:\n- Performance review findings\n- AbortController docs: https://developer.mozilla.org/en-US/docs/Web/API/AbortController","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T19:22:43.627493-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:22:43.627493-05:00"}
{"id":"psfpx","title":"Create Telegram bot via @BotFather, get token","description":"Setup task: Create a new Telegram bot using BotFather and save the bot token","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T11:00:17.455514-05:00","created_by":"benigeri","updated_at":"2026-01-05T12:34:36.212592-05:00","closed_at":"2026-01-05T12:34:36.212592-05:00","close_reason":"Token stored in .env"}
{"id":"psfxs","title":"Add dictation artifact note to draft-email prompt","description":"Add note to Claude prompt to ignore transcription artifacts like repeated words, filler words at end of dictation. See: .claude/skills/email-respond/IMPROVEMENT-PLAN.md","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-08T10:19:50.022876-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:57:07.684581-05:00","closed_at":"2026-01-08T10:57:07.684581-05:00","close_reason":"Added dictation artifact note to prompt in draft-email.py"}
{"id":"psfy3","title":"draft-email.py: --previous-draft fails when piping to same file","description":"Running 'python draft-email.py ... --previous-draft /tmp/file.json \u003e /tmp/file.json' fails because shell truncates the file before script reads it. Need to either: 1) Write to temp file then move, 2) Use different output mechanism, or 3) Document this limitation.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-09T08:32:11.616503-05:00","created_by":"benigeri","updated_at":"2026-01-09T08:48:58.500531-05:00","closed_at":"2026-01-09T08:48:58.500531-05:00","close_reason":"Fixed in commit 0367a7a on fix/email-workflow-bugs branch"}
{"id":"psg3c","title":"Fix draft not appearing in Gmail (Bug #6)","description":"Added --verify and --no-reply-to debug flags to create-gmail-draft.py. Need live testing to diagnose: try --no-reply-to to see if draft appears, use --verify to confirm creation. Original issue: Script reports success but draft doesn't show in Gmail.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T10:19:37.586396-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:42:43.08656-05:00","closed_at":"2026-01-08T10:42:43.08656-05:00","close_reason":"Verified working - draft creation confirmed with --verify flag during E2E test"}
{"id":"psgsx","title":"[epic] Email Workflow: Compose New Emails","description":"Add compose-from-scratch capability to web app. Allows users to create net-new emails (not replies). Includes /compose route, To/CC/Subject form, Braintrust integration for AI drafting.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T19:56:33.963479-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:32:04.535858-05:00","dependencies":[{"issue_id":"psgsx","depends_on_id":"ps0so","type":"blocks","created_at":"2026-01-10T19:56:40.58083-05:00","created_by":"benigeri"}]}
{"id":"psgvp","title":"Add forward feature to email workflow web app","description":"Add forward feature to web app (https://email-workflow-phi.vercel.app). When viewing a thread, add 'Forward' button that allows user to forward the entire thread to a new recipient. **Nylas API Research (keep for reference):** No native forward endpoint - must manually build forward body. Use Gmail-style format with gmail_quote div (NOT blockquote). Include forwarded message headers (From/Date/Subject/To). Set subject to 'Fwd: {original}'. Omit reply_to_message_id (forwards start new threads). See original bead description for detailed HTML format examples.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T12:00:26.60608-05:00","created_by":"benigeri","updated_at":"2026-01-10T13:33:13.715145-05:00"}
{"id":"pshft","title":"Set up Nylas environment variables","description":"Configure shell profile with required Nylas credentials.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.566675-05:00","updated_at":"2026-01-06T18:40:32.858545-05:00","closed_at":"2026-01-06T18:40:32.858545-05:00","close_reason":"Env vars in .zshrc, directory at ~/.claude/skills/weekly-cadence/","dependencies":[{"issue_id":"pshft","depends_on_id":"ps5r9","type":"parent-child","created_at":"2026-01-06T08:41:57.286255-05:00","created_by":"benigeri"}]}
{"id":"pshkq","title":"Parallelize draft save and label update in approve flow","description":"Optimize the approve workflow by running draft save and label update API calls in parallel instead of sequentially.\n\n**Context**: PR #61 performance review found that approve action takes 700ms due to sequential API calls: draft save (500ms) → wait → label update (200ms).\n\n**Current Flow**:\n```\nDraft save:     [========] 500ms\n                           Label update: [====] 200ms\nTotal:          [============] 700ms\n```\n\n**Optimized Flow**:\n```\nDraft save:     [========] 500ms\nLabel update:   [====] 200ms\nTotal:          [========] 500ms (30% faster)\n```\n\n**Scope**:\n- Refactor PUT /api/drafts route.ts:136-148\n- Use Promise.all() to run both operations concurrently\n- Handle partial failures (draft succeeds, labels fail)\n- Return appropriate status codes\n- Write tests for parallel execution\n\n**Acceptance Criteria**:\n- [ ] Draft save and label update run in parallel\n- [ ] Total time reduced from 700ms to ~500ms\n- [ ] Partial failures handled correctly\n- [ ] Tests verify both operations execute\n- [ ] Performance improvement measured\n\n**Resources**:\n- Performance review findings\n- File: email-workflow/app/api/drafts/route.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T19:22:43.460025-05:00","created_by":"benigeri","updated_at":"2026-01-10T20:02:05.573939-05:00","closed_at":"2026-01-10T20:02:05.573939-05:00","close_reason":"Parallelized draft JSON parsing and label update using Promise.allSettled. Both operations now run concurrently after draft save completes. Reduces total approve time from ~700ms to ~500ms (30% faster). Maintains retry logic for labels and handles partial failures correctly."}
{"id":"pshl2","title":"Add reply confirmation or bot like for message acknowledgment","description":"When a message is processed successfully, the bot should either reply with a confirmation message containing the Linear issue link, or react/like the original message to acknowledge receipt. This provides user feedback that their message was captured.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-05T13:54:21.558806-05:00","created_by":"benigeri","updated_at":"2026-01-05T14:06:31.47049-05:00","closed_at":"2026-01-05T14:06:31.47049-05:00","close_reason":"Closed"}
{"id":"psi3u","title":"Fix label removal after draft creation (Bug #5)","description":"Labels not being removed after draft creation. Root cause: update_message_labels() updates ONE message, not thread. Fix: Use thread update endpoint or update all messages. See: .claude/skills/email-respond/IMPROVEMENT-PLAN.md","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T10:19:37.245877-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:31:19.201814-05:00","closed_at":"2026-01-08T10:31:19.201814-05:00","close_reason":"Fixed label update to use thread endpoint instead of message endpoint"}
{"id":"psid1","title":"Add authentication to email workflow API routes","description":"Implement authentication middleware to protect all email workflow API endpoints from unauthorized access.\n\n**Context**: PR #61 review found NO authentication on any API routes. Anyone can call /api/drafts, /api/threads without logging in.\n\n**Current Risk**:\n- Unauthorized access to email operations\n- Anyone can generate drafts\n- Anyone can save drafts to Gmail\n- Anyone can modify email labels\n\n**Scope**:\n- Implement Next.js middleware with session validation\n- Add authentication check to all /api/* routes\n- Verify user owns the Nylas grant ID\n- Return 401 Unauthorized for unauthenticated requests\n- Add session management (cookie or JWT)\n- Write tests for auth middleware\n\n**Acceptance Criteria**:\n- [ ] Middleware checks authentication on all API routes\n- [ ] Unauthenticated requests return 401\n- [ ] User session verified before API access\n- [ ] Nylas grant ID ownership validated\n- [ ] Tests verify auth requirements\n\n**Resources**:\n- Security review findings\n- Next.js Auth docs: https://nextjs.org/docs/app/building-your-application/authentication","status":"open","priority":4,"issue_type":"bug","created_at":"2026-01-10T19:22:43.303671-05:00","created_by":"benigeri","updated_at":"2026-01-10T23:11:12.294356-05:00"}
{"id":"psidc","title":"Combine duplicate JSON output in create-gmail-draft.py","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T15:59:19.7674-05:00","created_by":"benigeri","updated_at":"2026-01-08T16:44:49.692851-05:00","closed_at":"2026-01-08T16:44:49.692851-05:00","close_reason":"Fixed in PR #44: single JSON output, label verification"}
{"id":"psjdb","title":"Refactor ThreadDetail component into smaller components","description":"Break down the 352-line ThreadDetail component into smaller, focused components following single responsibility principle.\n\n**Context**: PR #61 code review found ThreadDetail.tsx has too many responsibilities, making it hard to test and maintain.\n\n**Current Issues**:\n- 352 lines in single component\n- 7 state variables\n- 4 async functions\n- Mixed concerns: draft gen, iteration, navigation, session tracking, Gmail persistence\n\n**Proposed Structure**:\n```\nThreadDetail (orchestrator, 50 lines)\n├─ ThreadMessages (read-only message display, 40 lines)\n├─ ConversationHistory (iteration history display, 50 lines)\n└─ DraftWorkspace (150 lines)\n   ├─ DraftComposer (generate initial draft, 50 lines)\n   ├─ DraftPreview (show current draft, 30 lines)\n   ├─ DraftIterator (feedback + regenerate, 50 lines)\n   └─ DraftActions (skip + approve buttons, 40 lines)\n```\n\n**Scope**:\n- Extract ThreadMessages component\n- Extract ConversationHistory component\n- Extract DraftWorkspace with sub-components\n- Move business logic to custom hooks\n- Update tests for new components\n- Ensure all functionality preserved\n\n**Acceptance Criteria**:\n- [ ] ThreadDetail.tsx \u003c 100 lines\n- [ ] Each component has single responsibility\n- [ ] All components properly typed\n- [ ] Existing functionality unchanged\n- [ ] Tests updated and passing\n- [ ] No prop drilling (use context if needed)\n\n**Resources**:\n- File: email-workflow/app/inbox/ThreadDetail.tsx\n- React component composition docs","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T19:22:44.114188-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:22:44.114188-05:00"}
{"id":"psk5s","title":"Fix full page reload breaking client-side navigation","description":"**Bug**: Using window.location.href for navigation forces full page reload, destroying client-side state and breaking Next.js optimizations.\n\n**Location**: email-workflow/app/inbox/ThreadDetail.tsx:150, 195\n\n**Current Code**:\n```typescript\nwindow.location.href = `/inbox?thread=${nextThreadId}`;\n```\n\n**Impact**:\n- **Slow navigation**: 1500ms full reload vs 150ms client-side (10x slower)\n- Loses React component state\n- Re-downloads thread list from server\n- No browser transitions\n- Breaks browser back button behavior\n- Poor mobile experience\n\n**Expected Behavior**:\nUse Next.js router for client-side navigation:\n```typescript\nimport { useRouter } from 'next/navigation';\n\nconst router = useRouter();\nrouter.push(`/inbox?thread=${nextThreadId}`);\n```\n\n**Performance Comparison**:\n- Current: 1500ms (full page load)\n- Fixed: 150ms (client-side nav)\n- **90% faster**\n\n**Acceptance Criteria**:\n- [ ] useRouter imported and used\n- [ ] window.location.href removed from Skip handler\n- [ ] window.location.href removed from Approve handler\n- [ ] Navigation still works correctly\n- [ ] Thread list not re-fetched on navigation\n- [ ] Test verifies navigation performance\n- [ ] Test verifies state preservation\n\n**Test Required**: ✅ Yes","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T19:29:10.741737-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:48:52.887981-05:00","closed_at":"2026-01-10T19:48:52.887981-05:00","close_reason":"Replaced window.location.href with Next.js router.push() for client-side navigation. Prevents full page reloads when navigating between threads. Used in handleSkip and handleApprove functions. Test pending."}
{"id":"psknx","title":"Deploy function + set Telegram webhook","description":"Deploy edge function to Supabase and configure Telegram webhook URL","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:38.470082-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:49:55.262641-05:00","closed_at":"2026-01-05T13:49:55.262641-05:00","close_reason":"Closed"}
{"id":"psl9c","title":"nylas-webhook: workflow label logic + tests","description":"TDD: Create workflow label logic in lib/workflow-labels.ts:\n- isWorkflowLabel(folder): check if folder is a workflow label\n- getWorkflowLabels(folders): extract workflow labels from folder list\n- removeWorkflowLabels(folders, keepLabel?): filter out workflow labels\n- getHighestPriorityLabel(labels): return highest priority workflow label\n- All operations must be idempotent","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:27:57.162742-05:00","created_by":"benigeri","updated_at":"2026-01-07T14:37:16.768643-05:00","closed_at":"2026-01-07T14:37:16.768643-05:00","close_reason":"Closed","dependencies":[{"issue_id":"psl9c","depends_on_id":"pspeq","type":"blocks","created_at":"2026-01-07T11:28:25.468086-05:00","created_by":"benigeri"}]}
{"id":"psm5w","title":"Test end-to-end: reply → comment on issue","description":"Milestone 2: E2E test - reply to Telegram message creates comment on corresponding Linear issue","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T11:00:52.419636-05:00","created_by":"benigeri","updated_at":"2026-01-05T11:00:52.419636-05:00"}
{"id":"psmhg","title":"Email workflow: Debug draft-email.py prompts for better output","description":"## Problem\nUser dictation is NOT passed to the AI at all!\ndraft-email.py only accepts thread_id, not what the user wants to say.\n\n## Solution  \nAdd --dictation argument to draft-email.py. See docs/email-workflow-improvements.md Issue #2.\n\n## Implementation\n- Add --dictation (required), --feedback, --previous-draft args\n- Update prompt structure: [guidelines] + [examples] + [thread] + [dictation]\n- Support multi-turn for feedback iterations\n\n## This is Phase 1 - do this first!","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T22:27:19.640325-05:00","created_by":"benigeri","updated_at":"2026-01-08T08:23:02.025186-05:00","closed_at":"2026-01-08T08:23:02.025186-05:00","close_reason":"Phase 1 complete: Added --dictation, --feedback, --previous-draft args to draft-email.py. PR #39 created."}
{"id":"psmup","title":"Fix race condition in draft state initialization","description":"**Bug**: Draft state initializes with stale value when navigating between threads rapidly, showing wrong draft content briefly.\n\n**Location**: email-workflow/app/inbox/ThreadDetail.tsx:42\n\n**Current Code**:\n```typescript\nconst [draft, setDraft] = useState(storedDraft || '');\n```\n\n**Reproduction**:\n1. User opens Thread A, generates draft 'Hello from A'\n2. User clicks Skip, navigates to Thread B\n3. useState initializes with stale 'Hello from A' value\n4. Then useConversation loads and updates storedDraft to empty\n5. **User briefly sees wrong draft content**\n\n**Root Cause**:\nuseState captures storedDraft at component mount, but storedDraft loads asynchronously. The initial value is from the previous thread.\n\n**Expected Behavior**:\nDraft state should sync with storedDraft whenever it changes:\n```typescript\nconst [draft, setDraft] = useState('');\n\nuseEffect(() =\u003e {\n  setDraft(storedDraft || '');\n}, [storedDraft, thread.id]); // Reset on thread change\n```\n\n**Impact**:\n- Confusing UX (wrong draft shows briefly)\n- Potential for user to approve wrong draft\n- State desynchronization\n\n**Acceptance Criteria**:\n- [ ] Draft state syncs with storedDraft on change\n- [ ] Draft resets when thread.id changes\n- [ ] No stale draft content shown\n- [ ] Test verifies sync on thread navigation\n- [ ] Test covers rapid navigation scenario\n\n**Test Required**: ✅ Yes","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T19:29:10.574517-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:48:04.580598-05:00","closed_at":"2026-01-10T19:48:04.580598-05:00","close_reason":"Added useEffect to sync draft state with storedDraft whenever it changes. Prevents stale drafts from showing when navigating between threads quickly. Test pending."}
{"id":"psn0i","title":"Email Workflow: Add Skip and Approve buttons with navigation","description":"Add Skip/Approve buttons and auto-advance logic.\n\n**Skip Button:**\n- Go to next email in list\n- Leave labels unchanged\n- Clear conversation state\n- No draft saved\n\n**Approve Button:**\n- Create new PUT /api/drafts route\n- Save draft to Gmail via Nylas\n- Update labels (remove to-respond-paul, add drafted)\n- Clear conversation state\n- Auto-advance to next email\n\n**Navigation:**\n- Get next thread ID from inbox\n- Redirect to /inbox?thread={nextId}\n- If last email, redirect to /inbox\n\n**Test:**\n- Skip advances without saving\n- Approve saves and advances\n- Labels update correctly\n- Last email returns to inbox","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T16:35:56.286019-05:00","created_by":"benigeri","updated_at":"2026-01-10T20:01:02.48977-05:00","closed_at":"2026-01-10T20:01:02.48977-05:00","close_reason":"Skip/Approve buttons implemented with navigation. Skip clears conversation and navigates to next thread. Approve saves draft to Gmail via POST /api/drafts/save, updates labels, and auto-advances. Both use router.push for client-side nav."}
{"id":"psngo","title":"Email workflow: Rewrite SKILL.md with threads+panel+AI","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T21:03:25.393108-05:00","created_by":"benigeri","updated_at":"2026-01-07T22:06:28.15393-05:00","closed_at":"2026-01-07T22:06:28.15393-05:00","close_reason":"Merged PR #35: SKILL.md rewritten for thread-based workflow with tmux panel, AI drafting, and simplified JSON output","dependencies":[{"issue_id":"psngo","depends_on_id":"psbw2","type":"blocks","created_at":"2026-01-07T21:03:38.362675-05:00","created_by":"benigeri"},{"issue_id":"psngo","depends_on_id":"ps9lx","type":"blocks","created_at":"2026-01-07T21:03:38.424494-05:00","created_by":"benigeri"}]}
{"id":"psoc8","title":"Email workflow: Create drafted label","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T21:03:24.361258-05:00","created_by":"benigeri","updated_at":"2026-01-07T21:11:26.565819-05:00","closed_at":"2026-01-07T21:11:26.565819-05:00","close_reason":"Created 'drafted' label (Label_215) in Gmail via Nylas API. All workflow labels now exist: to-respond-paul, to-read-paul, drafted."}
{"id":"psohj","title":"Email Workflow: Implement draft feedback/iteration loop","description":"Add feedback textbox and regeneration flow.\n\n**UI:**\n- Feedback textarea below draft preview\n- 'Regenerate' button (or auto-trigger on submit)\n- Loading state during regeneration\n- Replace draft with new version\n\n**Flow:**\n1. User types feedback in textarea\n2. Click regenerate (or press Enter)\n3. Append feedback to conversation state\n4. Call POST /api/drafts with full conversation\n5. Show loading state\n6. Replace draft with new version\n7. Clear feedback textarea\n\n**Braintrust Integration:**\n- Pass full conversation history\n- Use messages array for context\n- Return only new assistant message\n\n**Test:**\n- Can iterate multiple times\n- Conversation history maintained\n- Draft updates correctly\n- Loading states work","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T16:35:56.515408-05:00","created_by":"benigeri","updated_at":"2026-01-10T20:01:02.659336-05:00","closed_at":"2026-01-10T20:01:02.659336-05:00","close_reason":"Feedback/iteration loop implemented. Users can provide feedback in textarea, click Regenerate to get new draft. Conversation history maintained in localStorage. regenerateDraft function appends feedback and calls POST /api/drafts with full history."}
{"id":"psouq","title":"Debug: Labels not updating after draft creation","description":"Labels (to-respond-paul → drafted) not being updated after draft creation despite previous fix. Need to debug create-gmail-draft.py label update logic. Previous fix (psi3u) claimed to use thread endpoint but may not be working.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T11:16:38.909086-05:00","created_by":"benigeri","updated_at":"2026-01-08T16:51:42.036367-05:00","closed_at":"2026-01-08T16:51:42.036367-05:00","close_reason":"Fixed in PR #44 and #45: label verification + INBOX filter"}
{"id":"psp9o","title":"Fix DRAFT system folder error in create-gmail-draft.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T15:59:18.814423-05:00","created_by":"benigeri","updated_at":"2026-01-08T16:51:42.022361-05:00","closed_at":"2026-01-08T16:51:42.022361-05:00","close_reason":"Fixed in PR #44 and #45: label verification + INBOX filter"}
{"id":"psp9v","title":"Refactor telegram-webhook to use captureToLinear()","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T08:21:16.6356-05:00","created_by":"benigeri","updated_at":"2026-01-06T09:18:38.501183-05:00","closed_at":"2026-01-06T09:18:38.501183-05:00","close_reason":"Closed","dependencies":[{"issue_id":"psp9v","depends_on_id":"ps0sq","type":"blocks","created_at":"2026-01-06T08:21:26.669001-05:00","created_by":"benigeri"}]}
{"id":"pspb3","title":"Write integration tests for index.ts, then implement","description":"TDD: Write integration tests for main handler - text and voice message flows, error handling","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:38.259414-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:26:19.371928-05:00","closed_at":"2026-01-05T13:26:19.371928-05:00","close_reason":"All 38 tests pass"}
{"id":"pspeq","title":"nylas-webhook: shared types (nylas-types.ts)","description":"Create shared Nylas types in _shared/lib/nylas-types.ts:\n- NylasMessage, NylasThread, NylasWebhookPayload interfaces\n- WORKFLOW_LABELS constant: to-respond-paul, to-read-paul, drafted\n- Label priority order: to-respond \u003e to-read \u003e drafted\n- Helper type: WorkflowLabel","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T11:27:54.466039-05:00","created_by":"benigeri","updated_at":"2026-01-07T14:27:19.980447-05:00","closed_at":"2026-01-07T14:27:19.980447-05:00","close_reason":"Closed"}
{"id":"psrbm","title":"Email Workflow: Install shadcn UI components","description":"Install shadcn/ui with vanilla setup.\n\n**Components to add:**\n- Button\n- Card (CardHeader, CardContent)\n- Textarea\n- Input\n- Badge (for message labels)\n\n**Steps:**\n1. Run shadcn/ui init\n2. Add components via CLI\n3. Verify styling works with Tailwind\n4. Update globals.css if needed\n\n**Test:**\n- Components render correctly\n- Styling matches shadcn defaults\n- No build errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T16:35:55.669135-05:00","created_by":"benigeri","updated_at":"2026-01-10T18:22:30.283698-05:00","closed_at":"2026-01-10T18:22:30.283698-05:00","close_reason":"Closed"}
{"id":"psrdv","title":"Fix line spacing in email draft preview","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-09T19:29:16.814532-05:00","created_by":"benigeri","updated_at":"2026-01-09T19:47:40.88541-05:00","closed_at":"2026-01-09T19:47:40.88541-05:00","close_reason":"Fixed in PR #53"}
{"id":"psrxr","title":"Fix label update return value ignored in create-gmail-draft.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T15:59:19.266184-05:00","created_by":"benigeri","updated_at":"2026-01-08T16:44:49.709061-05:00","closed_at":"2026-01-08T16:44:49.709061-05:00","close_reason":"Fixed in PR #44: single JSON output, label verification"}
{"id":"pssmy","title":"Email workflow: Improve tmux panel rendering performance","description":"## Problem\nPanel is slow: process restart per update, 3+ API calls each time, no caching.\nPanel sometimes disappears due to tmux send-keys escaping issues.\n\n## Solution\nPersistent process + Named Pipe (FIFO) IPC + caching. See docs/email-workflow-improvements.md Issue #3.\n\n## Implementation\n- Add --server mode to email-canvas.py\n- FIFO at /tmp/email-panel.fifo for commands\n- Base64 encode body content for multiline safety\n- In-memory cache for API responses\n- Loading indicators during API calls\n\n## This is Phase 3 - largest change, do last","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T22:27:19.890133-05:00","created_by":"benigeri","updated_at":"2026-01-08T16:51:47.991175-05:00","closed_at":"2026-01-08T16:51:47.991175-05:00","close_reason":"Implemented: server mode with stdin IPC, caching, loading indicators","dependencies":[{"issue_id":"pssmy","depends_on_id":"ps126","type":"blocks","created_at":"2026-01-08T08:15:46.818096-05:00","created_by":"benigeri"}]}
{"id":"psstv","title":"Email Workflow: Documentation","description":"Document the deployed app and usage.\n\nTasks:\n- Add README.md with setup instructions\n- Document environment variables\n- Add robots.txt for no indexing\n- Document mobile UX patterns\n- Add troubleshooting guide\n\nEstimated: 2 hours","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T12:32:24.453415-05:00","created_by":"benigeri","updated_at":"2026-01-10T13:18:58.013674-05:00","closed_at":"2026-01-10T13:18:58.013674-05:00","close_reason":"Essential documentation complete: README.md with setup instructions, DEPLOYMENT.md with deployment guide, STATUS.md with project status, robots.txt for SEO prevention, and troubleshooting guide included. Mobile UX patterns deferred as lower priority.","dependencies":[{"issue_id":"psstv","depends_on_id":"psurq","type":"blocks","created_at":"2026-01-10T12:32:29.349232-05:00","created_by":"benigeri"}]}
{"id":"pssy7","title":"Text to add to todo list","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T21:36:26.758638-05:00","created_by":"benigeri","updated_at":"2026-01-05T11:01:15.2126-05:00","closed_at":"2026-01-05T11:01:15.2126-05:00","close_reason":"Replaced with Telegram pipeline beads"}
{"id":"psucw","title":"Add progress count display to email panel","description":"Show running count like '3/12 drafted, 2 skipped' in panel header during workflow. See: .claude/skills/email-respond/IMPROVEMENT-PLAN.md","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T10:19:48.297908-05:00","created_by":"benigeri","updated_at":"2026-01-08T10:59:31.615519-05:00","closed_at":"2026-01-08T10:59:31.615519-05:00","close_reason":"Added --drafted and --skipped args to email-canvas.py and panel-manager.sh"}
{"id":"psumh","title":"Handle localStorage quota exceeded in email workflow","description":"## Problem\nSilent data loss when localStorage quota is exceeded (5-10MB limit). Users lose conversation history without notification.\n\n## Solution\nImplement automatic pruning (keep last 20 conversations, 7-day TTL) with user notifications when quota is reached.\n\n## Acceptance Criteria\n- QuotaExceededError detected and handled\n- Automatic pruning removes old conversations\n- User sees notification when storage limit reached\n- Function returns boolean success/failure status\n\n## Resources\n- Todo file: todos/002-pending-p1-handle-localstorage-quota-exceeded.md\n- PR #60: https://github.com/benigeri/productiviy-system/pull/60\n- File: email-workflow/lib/conversation.ts\n\n## Effort\n2-3 hours","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T18:51:44.914155-05:00","created_by":"benigeri","updated_at":"2026-01-10T19:58:45.597184-05:00","closed_at":"2026-01-10T19:58:45.597184-05:00","close_reason":"Implemented quota handling in lib/conversation.ts:\n- Catch QuotaExceededError in setStore function\n- Auto-prune old conversations (keep last 20, 7-day TTL)\n- Retry save after pruning\n- Return success/failure status from all storage functions\n- Updated useConversation hook to expose storageWarning state\n- User gets notification when storage limit reached and pruning occurs"}
{"id":"psurq","title":"Email Workflow: Test \u0026 Deploy","description":"Test locally and deploy to Vercel.\n\nTasks:\n- Test with real emails locally\n- Verify mobile responsive\n- Test error scenarios\n- Push to GitHub\n- Deploy to Vercel\n- Add environment variables\n- Test deployed version on mobile\n\nEstimated: 4 hours","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:32:19.607465-05:00","created_by":"benigeri","updated_at":"2026-01-10T13:12:28.587293-05:00","closed_at":"2026-01-10T13:12:28.587293-05:00","close_reason":"Deployment complete and verified. App successfully deployed to https://email-workflow-phi.vercel.app with full end-to-end workflow tested (inbox loading, thread viewing, draft generation via Braintrust, draft saving to Gmail via Nylas, label updates). Fixed 3 issues during deployment: Zod validation, Braintrust Mustache template syntax, and environment variable formatting.","dependencies":[{"issue_id":"psurq","depends_on_id":"ps3jh","type":"blocks","created_at":"2026-01-10T12:32:29.302388-05:00","created_by":"benigeri"}]}
{"id":"psuvi","title":"Create iOS Shortcut to open bot chat","description":"Create iOS Shortcut using tg://resolve?domain=BOT_USERNAME URL for one-tap access","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T11:00:39.073625-05:00","created_by":"benigeri","updated_at":"2026-01-05T14:23:45.549174-05:00","closed_at":"2026-01-05T14:23:45.549174-05:00","close_reason":"User set up shortcut manually"}
{"id":"psv31","title":"Write SKILL.md with workflow instructions","description":"Create main skill file with Claude instructions for the calendar management workflow.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.567796-05:00","updated_at":"2026-01-06T18:43:04.935892-05:00","closed_at":"2026-01-06T18:43:04.935892-05:00","close_reason":"Created SKILL.md with trigger, workflow, defaults, and example interaction","dependencies":[{"issue_id":"psv31","depends_on_id":"ps5r9","type":"parent-child","created_at":"2026-01-06T08:42:02.810896-05:00","created_by":"benigeri"},{"issue_id":"psv31","depends_on_id":"psagg","type":"blocks","created_at":"2026-01-06T08:42:08.435391-05:00","created_by":"benigeri"}]}
{"id":"psvbf","title":"Test end-to-end: text + voice → Linear triage","description":"End-to-end testing: send text and voice messages via Telegram, verify Linear triage items are created","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T11:00:38.857909-05:00","created_by":"benigeri","updated_at":"2026-01-05T13:55:11.254951-05:00","closed_at":"2026-01-05T13:55:11.254951-05:00","close_reason":"Closed"}
{"id":"psvui","title":"Create nylas-api-reference.md","description":"Document Nylas API endpoints for reference.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.568036-05:00","updated_at":"2026-01-06T18:42:31.913105-05:00","closed_at":"2026-01-06T18:42:31.913105-05:00","close_reason":"Created nylas-api-reference.md with endpoints, examples, and time format docs","dependencies":[{"issue_id":"psvui","depends_on_id":"ps5r9","type":"parent-child","created_at":"2026-01-06T08:42:02.889597-05:00","created_by":"benigeri"}]}
{"id":"psvvs","title":"Investigate: /manage-calendar not visible in slash menu","description":"User reports /manage-calendar command exists but doesn't appear in slash command menu. Command file exists at .claude/commands/manage-calendar.md. Need to investigate why it's not showing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:32:12.16545-05:00","created_by":"benigeri","updated_at":"2026-01-09T08:48:58.493065-05:00","closed_at":"2026-01-09T08:48:58.493065-05:00","close_reason":"Fixed in commit 0367a7a on fix/email-workflow-bugs branch"}
{"id":"psvy9","title":"Create new Supabase project","description":"Setup task: Create a Supabase project for hosting the edge function","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T11:00:21.186406-05:00","created_by":"benigeri","updated_at":"2026-01-05T12:42:17.197821-05:00","closed_at":"2026-01-05T12:42:17.197821-05:00","close_reason":"Project created, credentials stored in .env"}
{"id":"pswlp","title":"Update email-canvas.py to 100 char width with card-based UI","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T15:59:29.397356-05:00","created_by":"benigeri","updated_at":"2026-01-08T17:38:22.805463-05:00","closed_at":"2026-01-08T17:38:22.805463-05:00","close_reason":"Implemented in feature/ux-improvements branch"}
{"id":"pswx8","title":"Nylas email workflow automation","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-07T11:27:38.049163-05:00","created_by":"benigeri","updated_at":"2026-01-07T16:09:28.004909-05:00","closed_at":"2026-01-07T16:09:28.004909-05:00","close_reason":"Core email workflow automation complete: webhook deployed, deduplication, archive \u0026 send detection all working."}
{"id":"pswy4","title":"Add CSRF protection to email workflow API routes","description":"Add CSRF token validation to all POST/PUT/DELETE endpoints in email-workflow to prevent cross-site request forgery attacks.\n\n**Context**: PR #61 code review identified that API routes have no CSRF protection, allowing attackers to force authenticated users to make unwanted API calls.\n\n**Scope**:\n- Install @edge-csrf/nextjs package\n- Create middleware.ts with CSRF validation for state-changing methods\n- Add CSRF token to page layout (meta tag or cookie)\n- Update all fetch calls in ThreadDetail.tsx to include CSRF token header\n- Add error handling for CSRF validation failures\n- Write tests for CSRF protection\n\n**Acceptance Criteria**:\n- [ ] CSRF middleware active on /api/* routes\n- [ ] POST/PUT/DELETE requests fail without valid token\n- [ ] GET requests work without CSRF token\n- [ ] Client-side fetch calls include CSRF token\n- [ ] Clear error messages when CSRF validation fails\n\n**Resources**:\n- Todo file: todos/009-pending-p0-add-csrf-protection-api-routes.md\n- OWASP CSRF Guide: https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html","status":"open","priority":4,"issue_type":"bug","created_at":"2026-01-10T19:22:42.98731-05:00","created_by":"benigeri","updated_at":"2026-01-10T23:11:12.981907-05:00"}
{"id":"psxdn","title":"nylas-webhook: remove labels on archive/send","description":"Extend webhook to handle:\n1. Archive: When INBOX removed from message, remove workflow labels\n2. Send: When reply sent (message.created in SENT), remove workflow labels from thread\n\nThis completes the core email workflow automation before building the skill.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:02:58.764234-05:00","created_by":"benigeri","updated_at":"2026-01-07T16:09:09.017633-05:00","closed_at":"2026-01-07T16:09:09.017633-05:00","close_reason":"Implemented and tested archive/send detection. PR #31."}
{"id":"psxhs","title":"Email Workflow: Refactor draft generation to not auto-save","description":"Update draft generation to show in UI only, no Gmail save until Approve.\n\n**API Changes:**\n- Keep POST /api/drafts for generation only (no Nylas save)\n- Remove auto-save to Gmail\n- Remove label updates from POST route\n- Return draft HTML only\n\n**UI Changes:**\n- Show generated draft in Card component\n- Add to conversation state\n- Don't redirect after generation\n- Show draft with feedback textbox below\n\n**Test:**\n- Draft generates but doesn't appear in Gmail\n- Can view draft in UI\n- Labels unchanged until Approve","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T16:35:56.055875-05:00","created_by":"benigeri","updated_at":"2026-01-10T20:01:02.806336-05:00","closed_at":"2026-01-10T20:01:02.806336-05:00","close_reason":"Draft generation refactored to not auto-save. POST /api/drafts returns draft body only (line 62-65: 'Return draft body only - no Gmail save or label updates yet'). Save only happens on Approve via POST /api/drafts/save."}
{"id":"psy0o","title":"Email workflow v2 improvements","description":"Email workflow improvements based on E2E testing session (2026-01-08). See plan: .claude/skills/email-respond/IMPROVEMENT-PLAN.md. Bug tracker: .claude/skills/email-respond/E2E-BUGS.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-08T10:19:29.133339-05:00","created_by":"benigeri","updated_at":"2026-01-10T13:32:51.017286-05:00","closed_at":"2026-01-10T13:32:51.017286-05:00","close_reason":"TMUX improvements completed Jan 8 (all 8 dependencies closed). Project pivoted to web app on Jan 10 - web app now deployed at https://email-workflow-phi.vercel.app","dependencies":[{"issue_id":"psy0o","depends_on_id":"psi3u","type":"blocks","created_at":"2026-01-08T10:21:03.531621-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"psg3c","type":"blocks","created_at":"2026-01-08T10:21:03.590991-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"psa5j","type":"blocks","created_at":"2026-01-08T10:21:03.666288-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"psucw","type":"blocks","created_at":"2026-01-08T10:21:03.739354-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"ps96g","type":"blocks","created_at":"2026-01-08T10:21:03.869081-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"psb65","type":"blocks","created_at":"2026-01-08T10:21:03.985628-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"psfxs","type":"blocks","created_at":"2026-01-08T10:21:04.094855-05:00","created_by":"benigeri"},{"issue_id":"psy0o","depends_on_id":"ps2fb","type":"blocks","created_at":"2026-01-08T10:23:07.744151-05:00","created_by":"benigeri"}]}
{"id":"pszgh","title":"Test Nylas API connectivity","description":"Verify API credentials work and can fetch calendar events.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T08:41:46.568267-05:00","updated_at":"2026-01-06T18:41:07.504146-05:00","closed_at":"2026-01-06T18:41:07.504146-05:00","close_reason":"API connectivity verified - calendar paul@archive.com accessible","dependencies":[{"issue_id":"pszgh","depends_on_id":"ps5r9","type":"parent-child","created_at":"2026-01-06T08:42:02.980017-05:00","created_by":"benigeri"},{"issue_id":"pszgh","depends_on_id":"pshft","type":"blocks","created_at":"2026-01-06T08:42:08.385454-05:00","created_by":"benigeri"}]}
{"id":"pszi2","title":"Fix tmux pane width (use -l 102 instead of -p 40)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-09T19:29:16.52573-05:00","created_by":"benigeri","updated_at":"2026-01-09T19:47:40.883556-05:00","closed_at":"2026-01-09T19:47:40.883556-05:00","close_reason":"Fixed in PR #53"}
{"id":"pszrc","title":"[epic] Email Workflow: Forward Feature","description":"Add email forwarding capability to web app. Allows users to forward entire thread to new recipients. Includes Nylas API integration for forward body construction with Gmail-style formatting.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T19:56:33.459535-05:00","created_by":"benigeri","updated_at":"2026-01-11T00:32:12.441634-05:00","dependencies":[{"issue_id":"pszrc","depends_on_id":"psgvp","type":"blocks","created_at":"2026-01-10T19:56:40.535798-05:00","created_by":"benigeri"}]}
